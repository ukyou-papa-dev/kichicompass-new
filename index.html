<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€å½“ãŸã‚‹ã€‘ç„¡æ–™å ã„ KichiCompass | æ‹æ„›ãƒ»ä»•äº‹ãƒ»é‡‘é‹ 2024å¹´æœ€æ–°</title>
    <meta name="description" content="é©šç•°ã®çš„ä¸­ç‡98.7%ï¼æ‹æ„›ã€ä»•äº‹ã€é‡‘é‹ã‚’ç„¡æ–™ã§å ã†ã€‚ã‚ãªãŸã ã‘ã®è©³ç´°ãªå ã„çµæœã‚’ä»Šã™ããƒã‚§ãƒƒã‚¯ã€‚åˆå›87%OFFå®Ÿæ–½ä¸­ã€‚">
    <meta name="keywords" content="å ã„,ç„¡æ–™å ã„,æ‹æ„›å ã„,ã‚¿ãƒ­ãƒƒãƒˆ,å››æŸ±æ¨å‘½,æ•°ç§˜è¡“,å½“ãŸã‚‹å ã„,2024å¹´å ã„">
    <meta property="og:title" content="ã€å½“ãŸã‚‹ã€‘ç„¡æ–™å ã„ KichiCompass">
    <meta property="og:description" content="é©šç•°ã®çš„ä¸­ç‡98.7%ï¼ã‚ãªãŸã®é‹å‘½ã‚’ä»Šã™ãå ã†">
    <meta property="og:image" content="https://ukyou-papa-dev.github.io/kichicompass-new/ogp.jpg">
    <meta property="og:url" content="https://ukyou-papa-dev.github.io/kichicompass-new/">
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XENJ6H8FDN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-XENJ6H8FDN');
      
      function trackEvent(action, category) {
        gtag('event', action, {
          'event_category': category
        });
      }
    </script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Hiragino Sans', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .countdown {
            position: fixed;
            top: 0;
            width: 100%;
            background: linear-gradient(90deg, #ff0000, #ff6600);
            padding: 12px;
            text-align: center;
            font-weight: bold;
            z-index: 1000;
            animation: flash 1s infinite;
        }
        
        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 20px 40px;
        }
        
        h1 {
            font-size: 3em;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .visitor-count {
            text-align: center;
            margin: 20px 0;
        }
        
        .visitor-badge {
            display: inline-block;
            background: rgba(0,0,0,0.5);
            padding: 10px 25px;
            border-radius: 25px;
            color: #00ff00;
            font-family: monospace;
            font-size: 18px;
        }
        
        .fortune-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }
        
        .fortune-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        
        .fortune-card:hover {
            transform: translateY(-10px) scale(1.05);
            background: rgba(255,255,255,0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .fortune-card h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .cta-button {
            display: inline-block;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: white;
            padding: 18px 50px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.3em;
            margin: 20px;
            animation: pulse 2s infinite;
            box-shadow: 0 5px 20px rgba(255,215,0,0.5);
            border: none;
            cursor: pointer;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,215,0,0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(255,215,0,0); }
            100% { transform: scale(1); }
        }
        
        .popup {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            color: #333;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            animation: slideIn 0.5s;
            z-index: 999;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-150%); }
            to { transform: translateX(0); }
        }
        
        #form-section, #result-section {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        input {
            width: 100%;
            max-width: 400px;
            padding: 15px;
            margin: 10px auto;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            display: block;
        }

        .special-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 10000;
            box-shadow: 0 10px 50px rgba(0,0,0,0.5);
        }

        .exit-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .exit-modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
        }

        #email-capture {
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2));
            padding: 30px;
            border-radius: 15px;
            margin: 40px auto;
            max-width: 500px;
            text-align: center;
            border: 2px solid gold;
        }

        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .share-button {
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            color: white;
            font-weight: bold;
            transition: transform 0.3s;
        }

        .share-button:hover {
            transform: scale(1.1);
        }

        .twitter-share {
            background: #1DA1F2;
        }

        .line-share {
            background: #00B900;
        }

        .facebook-share {
            background: #1877F2;
        }

        .referral-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .referral-code {
            font-size: 24px;
            font-weight: bold;
            color: #FFD700;
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-radius: 10px;
            display: inline-block;
            margin: 10px 0;
        }

        .daily-bonus {
            position: fixed;
            top: 60px;
            right: 20px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 999;
            display: none;
        }
    </style>
</head>
<body>
    <div class="countdown" id="countdown">
        âš ï¸ åˆå›87%OFFçµ‚äº†ã¾ã§: è¨ˆç®—ä¸­...
    </div>

    <!-- 7æ—¥é–“é€£ç¶šãƒ­ã‚°ã‚¤ãƒ³ãƒœãƒ¼ãƒŠã‚¹è¡¨ç¤º -->
    <div class="daily-bonus" id="daily-bonus">
        <h3>ğŸ ãƒ­ã‚°ã‚¤ãƒ³ãƒœãƒ¼ãƒŠã‚¹</h3>
        <p>Day <span id="login-day">1</span>/7</p>
        <p>ã‚ã¨<span id="days-left">6</span>æ—¥ã§ç‰¹åˆ¥é‘‘å®šè§£æ”¾ï¼</p>
    </div>
    
    <div class="container">
        <h1>ğŸ”® KichiCompass ğŸ”®</h1>
        <p style="text-align:center;font-size:1.2em;">ã‚ãªãŸã ã‘ã®é‹å‘½ã®ç¾…é‡ç›¤</p>
        
        <div class="visitor-count">
            <div class="visitor-badge" id="visitors">
                ğŸ”´ ç¾åœ¨523åãŒé‘‘å®šä¸­
            </div>
        </div>

        <!-- ãƒ¡ãƒ¼ãƒ«åé›†ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div id="email-capture">
            <h2 style="color: gold; margin-bottom: 20px;">
                ğŸ æ¯æ—¥ã®é‹å‹¢ã‚’ç„¡æ–™ã§ãŠå±Šã‘
            </h2>
            <p style="margin-bottom: 20px;">
                ä»Šãªã‚‰ç™»éŒ²è€…é™å®šã§ç‰¹åˆ¥ãªå ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆï¼
            </p>
            <form onsubmit="captureEmail(event)">
                <input type="email" 
                       placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›" 
                       required
                       style="
                           width: 100%;
                           padding: 15px;
                           border-radius: 10px;
                           border: 2px solid gold;
                           margin-bottom: 15px;
                           font-size: 16px;
                           color: #333;
                       ">
                <button type="submit" class="cta-button" style="width:100%;margin:0;">
                    ç„¡æ–™ã§ç™»éŒ²ã™ã‚‹
                </button>
            </form>
        </div>

        <!-- å‹é”ç´¹ä»‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="referral-section" id="referral-section" style="display:none;">
            <h3>ğŸ‰ å‹é”ã‚’æ‹›å¾…ã—ã¦ç‰¹å…¸ã‚’ã‚²ãƒƒãƒˆï¼</h3>
            <p>ã‚ãªãŸã®ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ï¼š</p>
            <div class="referral-code" id="referral-code">LOADING...</div>
            <p>å‹é”ãŒç™»éŒ²ã™ã‚‹ã¨ã€ã‚ãªãŸã‚‚å‹é”ã‚‚ç‰¹åˆ¥ãªç‰¹å…¸ãŒã‚‚ã‚‰ãˆã¾ã™ï¼</p>
            <div class="share-buttons">
                <a href="#" onclick="shareWithCode('twitter')" class="share-button twitter-share">
                    Twitterã§å…±æœ‰
                </a>
                <a href="#" onclick="shareWithCode('line')" class="share-button line-share">
                    LINEã§å…±æœ‰
                </a>
            </div>
        </div>
        
        <div class="fortune-grid" id="fortune-selection">
            <div class="fortune-card" onclick="startFortune('astrology')">
                <h3>â­ è¥¿æ´‹å æ˜Ÿè¡“</h3>
                <p>12æ˜Ÿåº§ãŒå°ãé‹å‘½</p>
            </div>
            <div class="fortune-card" onclick="startFortune('tarot')">
                <h3>ğŸ´ ã‚¿ãƒ­ãƒƒãƒˆå ã„</h3>
                <p>78æšãŒç¤ºã™çœŸå®Ÿ</p>
            </div>
            <div class="fortune-card" onclick="startFortune('shichu')">
                <h3>ğŸ‰ å››æŸ±æ¨å‘½</h3>
                <p>æ±æ´‹æœ€é«˜ã®çš„ä¸­ç‡</p>
            </div>
            <div class="fortune-card" onclick="startFortune('numerology')">
                <h3>ğŸ”¢ æ•°ç§˜è¡“</h3>
                <p>æ•°å­—ãŒå°ãä½¿å‘½</p>
            </div>
        </div>
        
        <div style="text-align:center;">
            <button class="cta-button" onclick="startFortune()">
                ç„¡æ–™ã§ä»Šã™ãå ã†
            </button>
        </div>
        
        <div id="form-section">
            <h2>ã‚ãªãŸã®æƒ…å ±ã‚’å…¥åŠ›</h2>
            <input type="text" id="name" placeholder="ãŠåå‰" required>
            <input type="date" id="birthdate" required>
            <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä»»æ„ï¼‰">
            <input type="text" id="referral-input" placeholder="ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ï¼ˆãŠæŒã¡ã®æ–¹ï¼‰">
            <button class="cta-button" onclick="showResult()">
                é‹å‘½ã‚’è¦‹ã‚‹
            </button>
        </div>
        
        <div id="result-section">
            <!-- çµæœã¯JavaScriptã§å‹•çš„ã«æŒ¿å…¥ -->
        </div>
    </div>

    <!-- ç‰¹åˆ¥ãªãŠçŸ¥ã‚‰ã›ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div id="special-popup" class="special-popup" style="display:none;">
        <h2 style="margin-bottom:15px;">ğŸŒŸ ç‰¹åˆ¥ãªãŠçŸ¥ã‚‰ã› ğŸŒŸ</h2>
        <p style="margin-bottom:20px;">ã‚ãªãŸã¯é¸ã°ã‚Œã—<span id="visitor-number">14</span>äººç›®ã®è¨ªå•è€…ã§ã™ï¼</p>
        <p style="color:#FFD700;font-size:1.2em;margin-bottom:20px;">ä»Šã ã‘åˆå›87%OFF</p>
        <button onclick="closeSpecialPopup()" style="
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
        ">ç‰¹åˆ¥ä¾¡æ ¼ã§å§‹ã‚ã‚‹</button>
    </div>

    <!-- é›¢è„±é˜²æ­¢ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="exit-modal" class="exit-modal">
        <div class="exit-modal-content">
            <h2 style="color:#ff0000;margin-bottom:20px;">âš ï¸ ã¡ã‚‡ã£ã¨å¾…ã£ã¦ï¼</h2>
            <p style="color:#333;margin-bottom:20px;">ä»Šãªã‚‰ç‰¹åˆ¥ã«<br><span style="font-size:2em;color:#ff0000;">90%OFF</span><br>ã§ã”æä¾›ã—ã¾ã™ï¼</p>
            <p style="color:#666;margin-bottom:20px;">ã“ã®ãƒãƒ£ãƒ³ã‚¹ã¯äºŒåº¦ã¨ã‚ã‚Šã¾ã›ã‚“</p>
            <button onclick="goToStripe()" style="
                background: linear-gradient(45deg, #ff0000, #ff6600);
                color: white;
                border: none;
                padding: 15px 40px;
                border-radius: 30px;
                font-size: 18px;
                cursor: pointer;
                font-weight: bold;
                animation: pulse 1s infinite;
            ">ä»Šã™ã90%OFFã§å§‹ã‚ã‚‹</button>
            <br><br>
            <button onclick="closeExitModal()" style="
                background: none;
                border: none;
                color: #999;
                cursor: pointer;
                text-decoration: underline;
            ">ã„ã„ãˆã€çµæ§‹ã§ã™</button>
        </div>
    </div>
    
    <script>
        // Stripe URLå®šç¾©
        const STRIPE_URL = 'https://buy.stripe.com/test_aFa7sK5bP99E2pF8BUcV200';

        // 7æ—¥é–“ä¾å­˜ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
        const dailyMessages = {
            1: "ğŸŒŸ é‹å‘½ã®æ‰‰ãŒé–‹ã‹ã‚Œã¾ã—ãŸï¼ä»Šæ—¥ã‹ã‚‰7æ—¥é–“ã€ç‰¹åˆ¥ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚",
            2: "âš ï¸ é‡è¦ï¼šæ˜¨æ—¥ãŠä¼ãˆã§ããªã‹ã£ãŸå¤§åˆ‡ãªã“ã¨ãŒã‚ã‚Šã¾ã™...",
            3: "ğŸ”® è­¦å‘Šï¼š3æ—¥ä»¥å†…ã«è¡Œå‹•ã—ãªã„ã¨é‹æ°—ãŒä¸‹é™ã—ã¾ã™",
            4: "ğŸ’« ãƒãƒ£ãƒ³ã‚¹ï¼šæ˜æ—¥ã¾ã§ã®ç‰¹åˆ¥ã‚ªãƒ•ã‚¡ãƒ¼ãŒã‚ã‚Šã¾ã™",
            5: "â¤ï¸ ã‚ãªãŸã®é‹å‘½ã®äººãŒè¿‘ã¥ã„ã¦ã„ã¾ã™",
            6: "â° æœ€çµ‚è­¦å‘Šï¼šæ˜æ—¥ã§ç‰¹å…¸ãŒçµ‚äº†ã—ã¾ã™",
            7: "ğŸŠ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼7æ—¥é–“é”æˆç‰¹å…¸ã‚’è§£æ”¾ã—ã¾ã—ãŸï¼"
        };

        // ãƒ­ã‚°ã‚¤ãƒ³æ—¥æ•°ã®ç®¡ç†
        function updateLoginStreak() {
            const lastLogin = localStorage.getItem('lastLogin');
            const today = new Date().toDateString();
            let loginStreak = parseInt(localStorage.getItem('loginStreak') || '0');
            
            if (lastLogin !== today) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastLogin === yesterday.toDateString() || !lastLogin) {
                    loginStreak = Math.min(loginStreak + 1, 7);
                } else {
                    loginStreak = 1;
                }
                
                localStorage.setItem('loginStreak', loginStreak);
                localStorage.setItem('lastLogin', today);
                
                // ãƒœãƒ¼ãƒŠã‚¹è¡¨ç¤º
                showDailyBonus(loginStreak);
                
                // æ—¥æ›¿ã‚ã‚Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                if (dailyMessages[loginStreak]) {
                    setTimeout(() => {
                        alert(dailyMessages[loginStreak]);
                    }, 3000);
                }
            }
            
            return loginStreak;
        }

        // ãƒ­ã‚°ã‚¤ãƒ³ãƒœãƒ¼ãƒŠã‚¹è¡¨ç¤º
        function showDailyBonus(day) {
            const bonusDiv = document.getElementById('daily-bonus');
            document.getElementById('login-day').textContent = day;
            document.getElementById('days-left').textContent = 7 - day;
            bonusDiv.style.display = 'block';
            
            if (day === 7) {
                bonusDiv.innerHTML += '<p style="color:gold;">ğŸ ç‰¹åˆ¥é‘‘å®šãŒè§£æ”¾ã•ã‚Œã¾ã—ãŸï¼</p>';
            }
        }

        // ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
        function generateReferralCode() {
            const userId = localStorage.getItem('userId') || Math.random().toString(36).substring(2, 8);
            localStorage.setItem('userId', userId);
            const code = 'KICHI' + userId.toUpperCase();
            document.getElementById('referral-code').textContent = code;
            document.getElementById('referral-section').style.display = 'block';
            return code;
        }

        // SNSã‚·ã‚§ã‚¢æ©Ÿèƒ½
        function shareTwitter(text = '') {
            const defaultText = text || 'ã€ç„¡æ–™å ã„ã€‘KichiCompassã§å ã£ãŸã‚‰é©šãã®çµæœãŒ...ï¼çš„ä¸­ç‡98.7%ã®å ã„ã‚’ä»Šã™ãè©¦ã—ã¦ã¿ã¦ï¼';
            const url = 'https://ukyou-papa-dev.github.io/kichicompass-new/';
            const hashtags = 'å ã„,ç„¡æ–™å ã„,KichiCompass';
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(defaultText)}&url=${encodeURIComponent(url)}&hashtags=${hashtags}`, '_blank');
            
            trackEvent('share', 'twitter');
        }

        function shareLINE(text = '') {
            const defaultText = text || 'ã€ç„¡æ–™å ã„ã€‘KichiCompassãŒã™ã”ã„ï¼çš„ä¸­ç‡98.7%ã®å ã„ã‚’è©¦ã—ã¦ã¿ã¦ï¼';
            const url = 'https://ukyou-papa-dev.github.io/kichicompass-new/';
            window.open(`https://line.me/R/msg/text/?${encodeURIComponent(defaultText + '\n' + url)}`, '_blank');
            
            trackEvent('share', 'line');
        }

        function shareFacebook() {
            const url = 'https://ukyou-papa-dev.github.io/kichicompass-new/';
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
            
            trackEvent('share', 'facebook');
        }

        // ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ä»˜ãã‚·ã‚§ã‚¢
        function shareWithCode(platform) {
            const code = document.getElementById('referral-code').textContent;
            const text = `ã€ç„¡æ–™å ã„ã€‘ç§ã®ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ã€Œ${code}ã€ã‚’ä½¿ã†ã¨ç‰¹åˆ¥ç‰¹å…¸ãŒã‚‚ã‚‰ãˆã¾ã™ï¼KichiCompassã§é‹å‘½ã‚’å ãŠã†ï¼`;
            
            if (platform === 'twitter') {
                shareTwitter(text);
            } else if (platform === 'line') {
                shareLINE(text);
            }
        }

        // ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
        function checkReferralCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            if (refCode) {
                localStorage.setItem('referralCode', refCode);
                alert('ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãŒé©ç”¨ã•ã‚Œã¾ã—ãŸï¼ç‰¹åˆ¥ç‰¹å…¸ã‚’ç²å¾—ï¼');
            }
        }

        // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒãƒ¼
        setInterval(() => {
            const now = new Date();
            const tonight = new Date();
            tonight.setHours(23, 59, 59);
            const diff = tonight - now;
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            document.getElementById('countdown').textContent = 
                `âš ï¸ åˆå›87%OFFçµ‚äº†ã¾ã§: ${h}æ™‚é–“${m}åˆ†${s}ç§’`;
        }, 1000);
        
        // è¨ªå•è€…æ•°
        setInterval(() => {
            const count = 500 + Math.floor(Math.random() * 150);
            document.getElementById('visitors').textContent = 
                `ğŸ”´ ç¾åœ¨${count}åãŒé‘‘å®šä¸­`;
        }, 3000);
        
        // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—é€šçŸ¥
        setInterval(() => {
            const messages = [
                'æ±äº¬éƒ½ã®Aæ§˜ãŒç”³ã—è¾¼ã¿ã¾ã—ãŸ',
                'å¤§é˜ªåºœã®Kæ§˜ãŒæœ‰æ–™ãƒ—ãƒ©ãƒ³ã«ç™»éŒ²',
                'ç¦å²¡çœŒã®Mæ§˜ãŒå ã„ã‚’å®Œäº†',
                'ç¥å¥ˆå·çœŒã®Sæ§˜ãŒVIPãƒ—ãƒ©ãƒ³ã«ç”³ã—è¾¼ã¿',
                'æ„›çŸ¥çœŒã®Tæ§˜ãŒå‹é”ã‚’æ‹›å¾…ã—ã¾ã—ãŸ'
            ];
            const popup = document.createElement('div');
            popup.className = 'popup';
            popup.textContent = messages[Math.floor(Math.random() * messages.length)];
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 4000);
        }, 8000);

        // åˆå›è¨ªå•ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
        setTimeout(() => {
            const popup = document.getElementById('special-popup');
            const visitorNum = Math.floor(Math.random() * 100) + 1;
            document.getElementById('visitor-number').textContent = visitorNum;
            popup.style.display = 'block';
        }, 2000);

        // ç‰¹åˆ¥ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
        function closeSpecialPopup() {
            document.getElementById('special-popup').style.display = 'none';
            window.location.href = STRIPE_URL;
        }

        // é›¢è„±é˜²æ­¢
        let exitIntentShown = false;
        document.addEventListener('mouseout', (e) => {
            if (e.clientY < 10 && !exitIntentShown) {
                exitIntentShown = true;
                document.getElementById('exit-modal').style.display = 'flex';
            }
        });

        // é›¢è„±ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeExitModal() {
            document.getElementById('exit-modal').style.display = 'none';
        }

        // Stripeã¸ç§»å‹•
        function goToStripe() {
            window.location.href = STRIPE_URL;
        }

        // ãƒ¡ãƒ¼ãƒ«åé›†
        function captureEmail(e) {
            e.preventDefault();
            const email = e.target[0].value;
            
            let emails = JSON.parse(localStorage.getItem('emails') || '[]');
            emails.push({
                email: email,
                date: new Date().toISOString()
            });
            localStorage.setItem('emails', JSON.stringify(emails));
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'email_capture', {
                    'event_category': 'engagement'
                });
            }
            
            alert('ç™»éŒ²å®Œäº†ï¼æ¯æ—¥ã®é‹å‹¢ã‚’ãŠæ¥½ã—ã¿ã«ï¼');
            e.target[0].value = '';
            
            document.getElementById('email-capture').style.display = 'none';
        }
        
        // å ã„é–‹å§‹
        function startFortune(type) {
            document.getElementById('form-section').style.display = 'block';
            document.getElementById('fortune-selection').style.display = 'none';
            document.getElementById('email-capture').style.display = 'none';
            if(type) localStorage.setItem('fortuneType', type);
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'fortune_start', {
                    'event_category': 'engagement',
                    'event_label': type || 'general'
                });
            }
        }

        // å ã„ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ç¶­æŒï¼‰
        const fortuneTelling = {
            astrology: function(name, birthdate) {
                const date = new Date(birthdate);
                const month = date.getMonth() + 1;
                const day = date.getDate();
                
                let zodiac = '';
                if ((month == 3 && day >= 21) || (month == 4 && day <= 19)) zodiac = 'ç‰¡ç¾Šåº§';
                else if ((month == 4 && day >= 20) || (month == 5 && day <= 20)) zodiac = 'ç‰¡ç‰›åº§';
                else if ((month == 5 && day >= 21) || (month == 6 && day <= 20)) zodiac = 'åŒå­åº§';
                else if ((month == 6 && day >= 21) || (month == 7 && day <= 22)) zodiac = 'èŸ¹åº§';
                else if ((month == 7 && day >= 23) || (month == 8 && day <= 22)) zodiac = 'ç…å­åº§';
                else if ((month == 8 && day >= 23) || (month == 9 && day <= 22)) zodiac = 'ä¹™å¥³åº§';
                else if ((month == 9 && day >= 23) || (month == 10 && day <= 22)) zodiac = 'å¤©ç§¤åº§';
                else if ((month == 10 && day >= 23) || (month == 11 && day <= 21)) zodiac = 'è åº§';
                else if ((month == 11 && day >= 22) || (month == 12 && day <= 21)) zodiac = 'å°„æ‰‹åº§';
                else if ((month == 12 && day >= 22) || (month == 1 && day <= 19)) zodiac = 'å±±ç¾Šåº§';
                else if ((month == 1 && day >= 20) || (month == 2 && day <= 18)) zodiac = 'æ°´ç“¶åº§';
                else zodiac = 'é­šåº§';
                
                return `
                    <h2>${name}æ§˜ã¯${zodiac}ã§ã™</h2>
                    <div style="background:rgba(255,255,255,0.1);padding:20px;border-radius:10px;margin:20px 0;">
                        <h3>ğŸŒŸ æ‹æ„›é‹</h3>
                        <p>${name}æ§˜ã®æ‹æ„›é‹ã¯ä»Šã€ç‰¹åˆ¥ãªè»¢æ©Ÿã‚’è¿ãˆã¦ã„ã¾ã™ã€‚</p>
                        <p>${zodiac}ã®æŒã¤é­…åŠ›ãŒæœ€å¤§é™ã«ç™ºæ®ã•ã‚Œã‚‹æ™‚æœŸã§ã™ã€‚</p>
                        <p>ç‰¹ã«ä»Šæœˆã®15æ—¥å‰å¾Œã¯é‡è¦ãªå‡ºä¼šã„ã®å¯èƒ½æ€§ãŒ...</p>
                    </div>
                    <div class="share-buttons">
                        <a href="#" onclick="shareTwitter('ç§ã¯${zodiac}ï¼KichiCompassã§å ã£ãŸã‚‰é©šãã®çµæœãŒï¼')" class="share-button twitter-share">
                            çµæœã‚’ãƒ„ã‚¤ãƒ¼ãƒˆ
                        </a>
                        <a href="#" onclick="shareLINE('ç§ã¯${zodiac}ï¼ã™ã”ã„å ã„çµæœãŒå‡ºãŸï¼')" class="share-button line-share">
                            LINEã§å…±æœ‰
                        </a>
                    </div>
                    <div style="filter:blur(3px);background:rgba(255,255,255,0.05);padding:20px;border-radius:10px;position:relative;">
                        <p>ã—ã‹ã—ã€${name}æ§˜ã«ã¯æ³¨æ„ã™ã¹ãæ™‚æœŸãŒã‚ã‚Šã¾ã™ã€‚</p>
                        <p>é‡‘é‹ã§ã¯é©šãã¹ãå¤‰åŒ–ãŒ...</p>
                        <p>å¥åº·é¢ã§ã¯${zodiac}ç‰¹æœ‰ã®...</p>
                        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.95);padding:20px;border-radius:10px;text-align:center;">
                            <p style="color:gold;font-size:1.2em;">ğŸ’« è©³ç´°ã‚’è§£æ”¾ ğŸ’«</p>
                            <a href="${STRIPE_URL}" class="cta-button" style="margin-top:10px;">
                                ä»Šã ã‘480å††
                            </a>
                        </div>
                    </div>
                `;
            },
            
            tarot: function(name) {
                const cards = [
                    'æ„šè€…ï¼šæ–°ã—ã„å§‹ã¾ã‚Š',
                    'é­”è¡“å¸«ï¼šå‰µé€ åŠ›',
                    'å¥³æ•™çš‡ï¼šç›´æ„Ÿ',
                    'å¥³å¸ï¼šè±Šç©£',
                    'çš‡å¸ï¼šæ¨©å¨',
                    'æ•™çš‡ï¼šä¼çµ±',
                    'æ‹äººï¼šé¸æŠ',
                    'æˆ¦è»Šï¼šå‹åˆ©',
                    'åŠ›ï¼šå†…ãªã‚‹å¼·ã•',
                    'éš è€…ï¼šå†…çœ'
                ];
                
                const past = cards[Math.floor(Math.random() * cards.length)];
                const present = cards[Math.floor(Math.random() * cards.length)];
                const future = cards[Math.floor(Math.random() * cards.length)];
                
                return `
                    <h2>${name}æ§˜ã®ã‚¿ãƒ­ãƒƒãƒˆå ã„çµæœ</h2>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin:20px 0;">
                        <div style="background:rgba(255,255,255,0.1);padding:15px;border-radius:10px;">
                            <h4>éå»</h4>
                            <p>${past}</p>
                        </div>
                        <div style="background:rgba(255,255,255,0.1);padding:15px;border-radius:10px;">
                            <h4>ç¾åœ¨</h4>
                            <p>${present}</p>
                        </div>
                        <div style="background:rgba(255,255,255,0.1);padding:15px;border-radius:10px;">
                            <h4>æœªæ¥</h4>
                            <p>${future}</p>
                        </div>
                    </div>
                    <div class="share-buttons">
                        <a href="#" onclick="shareTwitter('ã‚¿ãƒ­ãƒƒãƒˆå ã„ã®çµæœãŒè¡æ’ƒçš„ï¼')" class="share-button twitter-share">
                            çµæœã‚’ãƒ„ã‚¤ãƒ¼ãƒˆ
                        </a>
                        <a href="#" onclick="shareLINE('ã‚¿ãƒ­ãƒƒãƒˆå ã„ãŒã™ã”ã‹ã£ãŸï¼')" class="share-button line-share">
                            LINEã§å…±æœ‰
                        </a>
                    </div>
                    <div style="filter:blur(3px);padding:20px;position:relative;">
                        <p>ã‚«ãƒ¼ãƒ‰ãŒç¤ºã™${name}æ§˜ã®æœ¬å½“ã®é‹å‘½ã¯...</p>
                        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.95);padding:20px;border-radius:10px;">
                            <a href="${STRIPE_URL}" class="cta-button">
                                å®Œå…¨è§£é‡ˆã‚’è¦‹ã‚‹
                            </a>
                        </div>
                    </div>
                `;
            },

            shichu: function(name, birthdate) {
                const date = new Date(birthdate);
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                const day = date.getDate();
                
                const tenkan = ['ç”²', 'ä¹™', 'ä¸™', 'ä¸', 'æˆŠ', 'å·±', 'åºš', 'è¾›', 'å£¬', 'ç™¸'];
                const chishi = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
                
                const yearIndex = (year - 4) % 60;
                const tenkanIndex = yearIndex % 10;
                const chishiIndex = yearIndex % 12;
                
                return `
                    <h2>${name}æ§˜ã®å››æŸ±æ¨å‘½</h2>
                    <div style="background:rgba(255,255,255,0.1);padding:20px;border-radius:10px;margin:20px 0;">
                        <h3>ğŸ‰ ã‚ãªãŸã®å‘½å¼</h3>
                        <p>å¹´æŸ±ï¼š${tenkan[tenkanIndex]}${chishi[chishiIndex]}</p>
                        <p>${name}æ§˜ã¯å¼·ã„é‹å‘½ã®æŒã¡ä¸»ã§ã™ã€‚</p>
                        <p>ç‰¹ã«é‡‘é‹ã¨ä»•äº‹é‹ã«ãŠã„ã¦ç´ æ™´ã‚‰ã—ã„æ‰èƒ½ãŒ...</p>
                    </div>
                    <div class="share-buttons">
                        <a href="#" onclick="shareTwitter('å››æŸ±æ¨å‘½ã§é©šãã®çµæœãŒï¼')" class="share-button twitter-share">
                            çµæœã‚’ãƒ„ã‚¤ãƒ¼ãƒˆ
                        </a>
                        <a href="#" onclick="shareLINE('å››æŸ±æ¨å‘½ãŒã™ã”ã„çš„ä¸­ç‡ï¼')" class="share-button line-share">
                            LINEã§å…±æœ‰
                        </a>
                    </div>
                    <div style="filter:blur(3px);background:rgba(255,255,255,0.05);padding:20px;border-radius:10px;position:relative;">
                        <p>ã—ã‹ã—ã€${name}æ§˜ã®å‘½å¼ã«ã¯ç‰¹åˆ¥ãªæš—ç¤ºãŒ...</p>
                        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.95);padding:20px;border-radius:10px;text-align:center;">
                            <p style="color:gold;">ğŸ’« å®Œå…¨ãªå‘½å¼è§£æ ğŸ’«</p>
                            <a href="${STRIPE_URL}" class="cta-button">
                                è©³ç´°ã‚’è¦‹ã‚‹
                            </a>
                        </div>
                    </div>
                `;
            },

            numerology: function(name, birthdate) {
                const date = new Date(birthdate);
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                const day = date.getDate();
                
                let lifePathNumber = (year + month + day).toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
                while (lifePathNumber > 9) {
                    lifePathNumber = lifePathNumber.toString().split('').reduce((a, b) => parseInt(a) + parseInt(b), 0);
                }
                
                const meanings = {
                    1: 'ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã¨ç‹¬ç«‹',
                    2: 'å”èª¿ã¨èª¿å’Œ',
                    3: 'å‰µé€ æ€§ã¨è¡¨ç¾',
                    4: 'å®‰å®šã¨å®Ÿè·µ',
                    5: 'è‡ªç”±ã¨å†’é™º',
                    6: 'æ„›ã¨è²¬ä»»',
                    7: 'æ¢æ±‚ã¨å†…çœ',
                    8: 'æˆåŠŸã¨ç‰©è³ª',
                    9: 'å¥‰ä»•ã¨å®Œæˆ'
                };
                
                return `
                    <h2>${name}æ§˜ã®æ•°ç§˜è¡“</h2>
                    <div style="background:rgba(255,255,255,0.1);padding:20px;border-radius:10px;margin:20px 0;">
                        <h3>ğŸ”¢ ãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹æ•°ï¼š${lifePathNumber}</h3>
                        <p>æ„å‘³ï¼š${meanings[lifePathNumber]}</p>
                        <p>${name}æ§˜ã®ä½¿å‘½ã¯ã€Œ${meanings[lifePathNumber]}ã€ã§ã™ã€‚</p>
                    </div>
                    <div class="share-buttons">
                        <a href="#" onclick="shareTwitter('ç§ã®ãƒ©ã‚¤ãƒ•ãƒ‘ã‚¹æ•°ã¯${lifePathNumber}ï¼')" class="share-button twitter-share">
                            çµæœã‚’ãƒ„ã‚¤ãƒ¼ãƒˆ
                        </a>
                        <a href="#" onclick="shareLINE('æ•°ç§˜è¡“ã§ç§ã®ä½¿å‘½ãŒã‚ã‹ã£ãŸï¼')" class="share-button line-share">
                            LINEã§å…±æœ‰
                        </a>
                    </div>
                    <div style="filter:blur(3px);padding:20px;position:relative;">
                        <p>${name}æ§˜ã¨ç›¸æ€§ã®è‰¯ã„äººã®ç‰¹å¾´...</p>
                        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.95);padding:20px;border-radius:10px;">
                            <a href="${STRIPE_URL}" class="cta-button">
                                å®Œå…¨ç‰ˆã‚’è¦‹ã‚‹
                            </a>
                        </div>
                    </div>
                `;
            }
        };
        
        // çµæœè¡¨ç¤º
        function showResult() {
            const name = document.getElementById('name').value || 'ã‚ãªãŸ';
            const birthdate = document.getElementById('birthdate').value;
            const fortuneType = localStorage.getItem('fortuneType') || 'astrology';
            const referralCode = document.getElementById('referral-input').value;
            
            // ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
            if (referralCode) {
                alert('ç´¹ä»‹ã‚³ãƒ¼ãƒ‰é©ç”¨ï¼åˆå›90%OFFã§ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ï¼');
            }
            
            let resultHTML = '';
            
            switch(fortuneType) {
                case 'astrology':
                    resultHTML = fortuneTelling.astrology(name, birthdate || '2000-01-01');
                    break;
                case 'tarot':
                    resultHTML = fortuneTelling.tarot(name);
                    break;
                case 'shichu':
                    resultHTML = fortuneTelling.shichu(name, birthdate || '2000-01-01');
                    break;
                case 'numerology':
                    resultHTML = fortuneTelling.numerology(name, birthdate || '2000-01-01');
                    break;
                default:
                    resultHTML = fortuneTelling.astrology(name, birthdate || '2000-01-01');
            }
            
            document.getElementById('result-section').style.display = 'block';
            document.getElementById('result-section').innerHTML = `
                <div style="max-width:800px;margin:0 auto;padding:20px;">
                    ${resultHTML}
                </div>
            `;
            
            document.getElementById('form-section').style.display = 'none';
            
            // çµæœã‚’ä¿å­˜
            const results = JSON.parse(localStorage.getItem('fortuneResults') || '[]');
            results.push({
                name: name,
                type: fortuneType,
                date: new Date().toISOString()
            });
            localStorage.setItem('fortuneResults', JSON.stringify(results));

            if (typeof gtag !== 'undefined') {
                gtag('event', 'fortune_complete', {
                    'event_category': 'engagement',
                    'event_label': fortuneType
                });
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.addEventListener('load', function() {
            updateLoginStreak();
            generateReferralCode();
            checkReferralCode();
        });
    </script>
</body>
</html>
