<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KichiCompass - あなただけの運命の羅針盤</title>
    
    <!-- ホーム画面アイコン設定 -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>🔮</text></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="KichiCompass">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="KichiCompass">
    <meta name="theme-color" content="#667eea">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ステップ表示 */
        .step {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        
        .step.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 神秘的なタイトル */
        .title {
            text-align: center;
            font-size: 28px;
            margin: 40px 0;
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
            animation: glow 2s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px rgba(255,255,255,0.5); }
            50% { text-shadow: 0 0 30px rgba(255,255,255,0.8); }
        }
        
        /* 入力フォーム */
        .input-group {
            margin: 30px 0;
        }
        
        .input-label {
            display: block;
            margin-bottom: 10px;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .input-field {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 16px;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }
        
        .input-field::placeholder {
            color: rgba(255,255,255,0.6);
        }
        
        .input-field:focus {
            outline: none;
            background: rgba(255,255,255,0.3);
            box-shadow: 0 0 30px rgba(255,255,255,0.3);
        }
        
        /* 魔法のボタン */
        .magic-button {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .magic-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }
        
        .magic-button:active {
            transform: translateY(0);
        }
        
        /* ローディングアニメーション */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 16px;
            opacity: 0.9;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 0.5; }
        }
        
        /* 仮診断結果 */
        .preview-result {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .result-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .result-text {
            line-height: 1.8;
            opacity: 0.95;
        }
        
        .blur-text {
            filter: blur(3px);
            user-select: none;
            position: relative;
        }
        
        .unlock-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            padding: 15px 25px;
            border-radius: 10px;
            white-space: nowrap;
        }
        
        /* 緊急性を煽る要素 */
        .urgency-banner {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            padding: 10px;
            text-align: center;
            border-radius: 10px;
            margin: 20px 0;
            animation: blink 2s ease-in-out infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .countdown {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            text-align: center;
            margin: 20px 0;
        }
        
        /* 社会的証明 */
        .social-proof {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-size: 14px;
        }
        
        .user-count {
            font-size: 20px;
            color: #ffd700;
            font-weight: bold;
        }
        
        /* ホーム画面追加誘導ポップアップ */
        .add-to-home-popup {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: white;
            color: #333;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 99999;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .add-to-home-content h3 {
            margin-bottom: 10px;
            color: #667eea;
        }

        .add-to-home-content ol {
            margin: 15px 0;
            padding-left: 20px;
        }

        .add-to-home-content button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ステップ1: 名前入力 -->
        <div class="step active" id="step1">
            <h1 class="title">✨ あなたの運命が呼んでいます ✨</h1>
            
            <div class="social-proof">
                現在 <span class="user-count" id="activeUsers">2,847</span> 人が鑑定中
            </div>
            
            <div class="input-group">
                <label class="input-label">あなたのお名前を教えてください</label>
                <input type="text" class="input-field" id="userName" placeholder="ニックネームでもOK" autocomplete="off">
            </div>
            
            <button class="magic-button" onclick="processStep1()">
                無料で運命を確認する →
            </button>
            
            <div class="urgency-banner">
                ⚡ 本日限定！通常3,980円→完全無料 ⚡
            </div>
        </div>
        
        <!-- ローディング画面 -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div class="loading-text" id="loadingText">
                宇宙からメッセージを受信中...
            </div>
        </div>
        
        <!-- ステップ2: 仮診断結果 -->
        <div class="step" id="step2">
            <h1 class="title">🌟 <span id="displayName"></span>様の運命 🌟</h1>
            
            <div class="preview-result">
                <div class="result-title">⚡ 緊急メッセージ</div>
                <div class="result-text" id="previewMessage"></div>
            </div>
            
            <div class="preview-result">
                <div class="result-title">💕 恋愛運</div>
                <div class="result-text">
                    <span id="lovePreview"></span>
                    <div class="blur-text">
                        実は、あなたのことを密かに想っている人が...
                        <div class="unlock-overlay">🔒 詳細を見るには生年月日が必要</div>
                    </div>
                </div>
            </div>
            
            <div class="countdown" id="countdown">
                詳細診断まで残り: <span id="timer">05:00</span>
            </div>
            
            <div class="input-group">
                <label class="input-label">より正確な診断のために生年月日を入力</label>
                <input type="date" class="input-field" id="birthDate">
            </div>
            
            <button class="magic-button" onclick="processStep2()">
                完全版を今すぐ確認する →
            </button>
        </div>
        
        <!-- ステップ3: 最終フック -->
        <div class="step" id="step3">
            <h1 class="title">⚠️ 重要な警告 ⚠️</h1>
            
            <div class="preview-result">
                <div class="result-title">🔮 <span id="finalName"></span>様だけへの特別なメッセージ</div>
                <div class="result-text" id="criticalMessage"></div>
            </div>
            
            <div class="preview-result">
                <div class="blur-text" style="padding: 20px;">
                    今後3日以内に、あなたの人生を大きく変える出来事が...
                    しかし、1つ間違えると取り返しのつかないことに...
                    <div class="unlock-overlay">🔓 続きを読む（480円）</div>
                </div>
            </div>
            
            <button class="magic-button" style="background: linear-gradient(45deg, #ffd700, #ffed4e);" onclick="processPayment()">
                今すぐ全てを知る（特別価格480円）
            </button>
            
            <div class="social-proof" style="margin-top: 20px;">
                ⭐ 98.7%の方が「人生が変わった」と回答
            </div>
        </div>
    </div>
    
    <script>
        // ユーザーデータ保存
        let userData = {
            name: '',
            birthDate: '',
            startTime: new Date(),
            step: 1
        };
        
        // 偽のアクティブユーザー数を動的に変更
        setInterval(() => {
            const users = document.getElementById('activeUsers');
            if (users) {
                const current = parseInt(users.textContent);
                const change = Math.floor(Math.random() * 50) - 25;
                users.textContent = Math.max(2000, current + change).toLocaleString();
            }
        }, 3000);
        
        // ステップ1処理
        function processStep1() {
            const name = document.getElementById('userName').value;
            if (!name) {
                alert('お名前を入力してください');
                return;
            }
            
            userData.name = name;
            localStorage.setItem('userData', JSON.stringify(userData));
            
            // ローディング演出
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                showStep2(name);
            }, 3000);
        }
        
        // ローディング表示
        function showLoading() {
            document.getElementById('step1').classList.remove('active');
            document.getElementById('loading').classList.add('active');
            
            // ローディングテキストを変更
            const texts = [
                '宇宙からメッセージを受信中...',
                'あなたの運命を解析中...',
                '守護霊と交信中...',
                '特別な結果が見つかりました！'
            ];
            
            let index = 0;
            const interval = setInterval(() => {
                document.getElementById('loadingText').textContent = texts[index];
                index++;
                if (index >= texts.length) {
                    clearInterval(interval);
                }
            }, 700);
        }
        
        // ローディング非表示
        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }
        
        // ステップ2表示
        function showStep2(name) {
            document.getElementById('step2').classList.add('active');
            document.getElementById('displayName').textContent = name;
            
            // パーソナライズされたメッセージ
            const messages = [
                `${name}様、実は昨日からあなたのことが気になっていました...`,
                `${name}様に今すぐ伝えなければならないことがあります...`,
                `${name}様の周りで大きな変化が起きようとしています...`
            ];
            
            const loveMessages = [
                '現在、恋愛運が急上昇中！',
                '運命の人との出会いが近づいています',
                '今月は恋愛における重要な転機'
            ];
            
            document.getElementById('previewMessage').textContent = 
                messages[Math.floor(Math.random() * messages.length)];
            
            document.getElementById('lovePreview').textContent = 
                loveMessages[Math.floor(Math.random() * loveMessages.length)];
            
            // カウントダウン開始
            startCountdown();
        }
        
        // カウントダウンタイマー
        function startCountdown() {
            let seconds = 300; // 5分
            const timer = setInterval(() => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                document.getElementById('timer').textContent = 
                    `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                
                seconds--;
                
                if (seconds < 0) {
                    clearInterval(timer);
                    document.getElementById('timer').textContent = '00:00';
                    document.getElementById('countdown').innerHTML = 
                        '<span style="color: #ff6b6b;">⚠️ 時間切れ！特別オファーが終了しました</span>';
                }
            }, 1000);
        }
        
        // ステップ2処理
        function processStep2() {
            const birthDate = document.getElementById('birthDate').value;
            if (!birthDate) {
                alert('生年月日を入力してください');
                return;
            }
            
            userData.birthDate = birthDate;
            userData.step = 3;
            localStorage.setItem('userData', JSON.stringify(userData));
            
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                showStep3();
            }, 3000);
        }
        
        // ステップ3表示
        function showStep3() {
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.add('active');
            document.getElementById('finalName').textContent = userData.name;
            
            // 緊急性の高いメッセージ
            const criticalMessages = [
                `${userData.name}様、これは偶然ではありません。今このタイミングでこのメッセージを読んでいるのには深い意味があります。`,
                `実は、${userData.name}様の運命に関わる重要な転機が訪れています。しかし、正しい選択をしないと...`,
                `${userData.name}様の守護霊が強く警告しています。今すぐ行動を起こさないと、大切なチャンスを逃すことに...`
            ];
            
            document.getElementById('criticalMessage').textContent = 
                criticalMessages[Math.floor(Math.random() * criticalMessages.length)];
        }
        
        // 決済処理
        function processPayment() {
            userData.converted = true;
            userData.conversionTime = new Date();
            localStorage.setItem('userData', JSON.stringify(userData));
            
            // 最初の480円決済へ
            window.location.href = 'https://buy.stripe.com/test_aFa7sK5bP99E2pF8BUcV200';
        }
        
        // ホーム画面追加の誘導
        function showAddToHomeScreen() {
            // iOSの場合
            if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
                const popup = document.createElement('div');
                popup.className = 'add-to-home-popup';
                popup.innerHTML = `
                    <div class="add-to-home-content">
                        <h3>📱 アプリのように使えます！</h3>
                        <p>ホーム画面に追加すると、いつでもすぐに占えます✨</p>
                        <ol>
                            <li>下の共有ボタン［⬆］をタップ</li>
                            <li>「ホーム画面に追加」を選択</li>
                            <li>「追加」をタップ</li>
                        </ol>
                        <button onclick="this.parentElement.parentElement.remove()">後で</button>
                    </div>
                `;
                document.body.appendChild(popup);
            }
            // Androidの場合
            else if (/Android/.test(navigator.userAgent)) {
                const popup = document.createElement('div');
                popup.className = 'add-to-home-popup';
                popup.innerHTML = `
                    <div class="add-to-home-content">
                        <h3>📱 アプリのように使えます！</h3>
                        <p>ホーム画面に追加すると、いつでもすぐに占えます✨</p>
                        <ol>
                            <li>右上の［⋮］メニューをタップ</li>
                            <li>「ホーム画面に追加」を選択</li>
                        </ol>
                        <button onclick="this.parentElement.parentElement.remove()">後で</button>
                    </div>
                `;
                document.body.appendChild(popup);
            }
        }

        // 3回目の訪問で表示
        let visitCount = localStorage.getItem('visitCount') || 0;
        visitCount++;
        localStorage.setItem('visitCount', visitCount);
        if (visitCount === 3) {
            setTimeout(showAddToHomeScreen, 5000);
        }
        
        // 離脱防止
        window.addEventListener('beforeunload', (e) => {
            if (userData.step > 1 && !userData.converted) {
                e.preventDefault();
                e.returnValue = '本当に離れますか？特別な診断結果が消えてしまいます...';
            }
        });
        
        // ページ読み込み時の処理
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('userData');
            if (saved) {
                userData = JSON.parse(saved);
                // 前回の続きから開始
                if (userData.step === 2) {
                    document.getElementById('step1').classList.remove('active');
                    showStep2(userData.name);
                } else if (userData.step === 3) {
                    document.getElementById('step1').classList.remove('active');
                    showStep3();
                }
            }
        });
    </script>
</body>
</html>
