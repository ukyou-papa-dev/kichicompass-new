<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KichiCompass - ã‚ãªãŸã ã‘ã®é‹å‘½ã®ç¾…é‡ç›¤</title>
    
    <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¢ã‚¤ã‚³ãƒ³è¨­å®š -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ”®</text></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="KichiCompass">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="KichiCompass">
    <meta name="theme-color" content="#667eea">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ã‚¹ãƒ†ãƒƒãƒ—è¡¨ç¤º */
        .step {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        
        .step.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ç¥ç§˜çš„ãªã‚¿ã‚¤ãƒˆãƒ« */
        .title {
            text-align: center;
            font-size: 28px;
            margin: 40px 0;
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
            animation: glow 2s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px rgba(255,255,255,0.5); }
            50% { text-shadow: 0 0 30px rgba(255,255,255,0.8); }
        }
        
        /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
        .input-group {
            margin: 30px 0;
        }
        
        .input-label {
            display: block;
            margin-bottom: 10px;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .input-field {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 16px;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }
        
        .input-field::placeholder {
            color: rgba(255,255,255,0.6);
        }
        
        .input-field:focus {
            outline: none;
            background: rgba(255,255,255,0.3);
            box-shadow: 0 0 30px rgba(255,255,255,0.3);
        }
        
        /* é­”æ³•ã®ãƒœã‚¿ãƒ³ */
        .magic-button {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .magic-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }
        
        .magic-button:active {
            transform: translateY(0);
        }
        
        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 16px;
            opacity: 0.9;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 0.5; }
        }
        
        /* ä»®è¨ºæ–­çµæœ */
        .preview-result {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .result-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: #ffd700;
        }
        
        .result-text {
            line-height: 1.8;
            opacity: 0.95;
        }
        
        .blur-text {
            filter: blur(3px);
            user-select: none;
            position: relative;
        }
        
        .unlock-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            padding: 15px 25px;
            border-radius: 10px;
            white-space: nowrap;
        }
        
        /* ç·Šæ€¥æ€§ã‚’ç…½ã‚‹è¦ç´  */
        .urgency-banner {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            padding: 10px;
            text-align: center;
            border-radius: 10px;
            margin: 20px 0;
            animation: blink 2s ease-in-out infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .countdown {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            text-align: center;
            margin: 20px 0;
        }
        
        /* ç¤¾ä¼šçš„è¨¼æ˜ */
        .social-proof {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-size: 14px;
        }
        
        .user-count {
            font-size: 20px;
            color: #ffd700;
            font-weight: bold;
        }
        
        /* ãƒ›ãƒ¼ãƒ ç”»é¢è¿½åŠ èª˜å°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
        .add-to-home-popup {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: white;
            color: #333;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 99999;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .add-to-home-content h3 {
            margin-bottom: 10px;
            color: #667eea;
        }

        .add-to-home-content ol {
            margin: 15px 0;
            padding-left: 20px;
        }

        .add-to-home-content button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
        }

        /* ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥é¢¨ */
        .push-notification {
            position: fixed;
            top: 20px;
            right: -400px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 350px;
            transition: right 0.3s ease;
            z-index: 10000;
        }

        .push-notification.show {
            right: 20px;
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }

        /* é›¢è„±ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
        .exit-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 99999;
        }

        .exit-popup.show {
            opacity: 1;
        }

        .exit-popup-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            text-align: center;
            color: #333;
            position: relative;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .exit-popup h2 {
            color: #ff6b6b;
            margin-bottom: 20px;
            font-size: 32px;
        }

        .exit-main-message {
            font-size: 18px;
            margin: 20px 0;
            line-height: 1.6;
        }

        .countdown-large {
            font-size: 36px;
            color: #ff6b6b;
            font-weight: bold;
            display: block;
            margin: 10px 0;
        }

        .exit-warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #ffc107;
        }

        .exit-offer {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .offer-badge {
            background: #ffd700;
            color: #333;
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .offer-price {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-size: 24px;
        }

        .original-price {
            text-decoration: line-through;
            opacity: 0.7;
        }

        .special-price {
            color: #ffd700;
            font-weight: bold;
            font-size: 32px;
        }

        .exit-cta {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 50px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.3s ease;
        }

        .exit-cta:hover {
            transform: scale(1.05);
        }

        .exit-close {
            background: transparent;
            color: #999;
            border: none;
            padding: 10px;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 10px;
        }

        /* è¨ºæ–­çµæœã®è©³ç´° */
        .fortune-details {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
        }

        .fortune-category {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }

        .fortune-category h3 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .fortune-locked {
            filter: blur(5px);
            position: relative;
            padding: 20px;
            user-select: none;
        }

        .unlock-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            padding: 15px 30px;
            border-radius: 50px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(255,215,0,0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ã‚¹ãƒ†ãƒƒãƒ—1: åå‰å…¥åŠ› -->
        <div class="step active" id="step1">
            <h1 class="title">âœ¨ ã‚ãªãŸã®é‹å‘½ãŒå‘¼ã‚“ã§ã„ã¾ã™ âœ¨</h1>
            
            <div class="social-proof">
                ç¾åœ¨ <span class="user-count" id="activeUsers">2,847</span> äººãŒé‘‘å®šä¸­
            </div>
            
            <div class="input-group">
                <label class="input-label">ã‚ãªãŸã®ãŠåå‰ã‚’æ•™ãˆã¦ãã ã•ã„</label>
                <input type="text" class="input-field" id="userName" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã§ã‚‚OK" autocomplete="off">
            </div>
            
            <button class="magic-button" onclick="processStep1()">
                ç„¡æ–™ã§é‹å‘½ã‚’ç¢ºèªã™ã‚‹ â†’
            </button>
            
            <div class="urgency-banner">
                âš¡ æœ¬æ—¥é™å®šï¼é€šå¸¸3,980å††â†’å®Œå…¨ç„¡æ–™ âš¡
            </div>
        </div>
        
        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div class="loading-text" id="loadingText">
                å®‡å®™ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ä¸­...
            </div>
        </div>
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—2: ä»®è¨ºæ–­çµæœ -->
        <div class="step" id="step2">
            <h1 class="title">ğŸŒŸ <span id="displayName"></span>æ§˜ã®é‹å‘½ ğŸŒŸ</h1>
            
            <div class="preview-result">
                <div class="result-title">âš¡ ç·Šæ€¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</div>
                <div class="result-text" id="previewMessage"></div>
            </div>
            
            <div class="preview-result">
                <div class="result-title">ğŸ’• æ‹æ„›é‹</div>
                <div class="result-text">
                    <span id="lovePreview"></span>
                    <div class="blur-text">
                        å®Ÿã¯ã€ã‚ãªãŸã®ã“ã¨ã‚’å¯†ã‹ã«æƒ³ã£ã¦ã„ã‚‹äººãŒ...
                        <div class="unlock-overlay">ğŸ”’ è©³ç´°ã‚’è¦‹ã‚‹ã«ã¯ç”Ÿå¹´æœˆæ—¥ãŒå¿…è¦</div>
                    </div>
                </div>
            </div>
            
            <div class="countdown" id="countdown">
                è©³ç´°è¨ºæ–­ã¾ã§æ®‹ã‚Š: <span id="timer">05:00</span>
            </div>
            
            <div class="input-group">
                <label class="input-label">ã‚ˆã‚Šæ­£ç¢ºãªè¨ºæ–­ã®ãŸã‚ã«ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›</label>
                <input type="date" class="input-field" id="birthDate">
            </div>
            
            <button class="magic-button" onclick="processStep2()">
                å®Œå…¨ç‰ˆã‚’ä»Šã™ãç¢ºèªã™ã‚‹ â†’
            </button>
        </div>
        
        <!-- ã‚¹ãƒ†ãƒƒãƒ—3: æœ€çµ‚ãƒ•ãƒƒã‚¯ -->
        <div class="step" id="step3">
            <h1 class="title">âš ï¸ é‡è¦ãªè­¦å‘Š âš ï¸</h1>
            
            <div class="preview-result">
                <div class="result-title">ğŸ”® <span id="finalName"></span>æ§˜ã ã‘ã¸ã®ç‰¹åˆ¥ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</div>
                <div class="result-text" id="criticalMessage"></div>
            </div>

            <!-- è©³ç´°ãªå ã„çµæœ -->
            <div class="fortune-details">
                <div class="fortune-category">
                    <h3>ğŸ’• æ‹æ„›é‹ã®è©³ç´°</h3>
                    <p id="loveFortune">ä»Šæœˆã¯ç‰¹åˆ¥ãªå‡ºä¼šã„ã®äºˆæ„ŸãŒ...é‹å‘½ã®äººã®ç‰¹å¾´ã¯...</p>
                </div>

                <div class="fortune-category">
                    <h3>ğŸ’° é‡‘é‹ã®è©³ç´°</h3>
                    <p id="moneyFortune">è‡¨æ™‚åå…¥ã®å¯èƒ½æ€§ãŒï¼ç‰¹ã«15æ—¥å‰å¾Œã¯...</p>
                </div>

                <div class="fortune-locked">
                    <div class="fortune-category">
                        <h3>âš ï¸ æ³¨æ„ã™ã¹ãæ—¥</h3>
                        <p>ä»Šæœˆã®è¦æ³¨æ„æ—¥ã¯...ã“ã®æ—¥ã ã‘ã¯çµ¶å¯¾ã«...</p>
                    </div>
                    <div class="fortune-category">
                        <h3>ğŸŒŸ æœ€é«˜ã®å¹¸é‹æ—¥</h3>
                        <p>ã‚ãªãŸã®é‹å‘½ãŒå¤§ããå‹•ãæ—¥ã¯...</p>
                    </div>
                    <button class="unlock-button" onclick="processPayment()">
                        ğŸ”“ ç¶šãã‚’èª­ã‚€ï¼ˆ480å††ï¼‰
                    </button>
                </div>
            </div>
            
            <button class="magic-button" style="background: linear-gradient(45deg, #ffd700, #ffed4e); margin-top: 30px;" onclick="processPayment()">
                ä»Šã™ãå…¨ã¦ã‚’çŸ¥ã‚‹ï¼ˆç‰¹åˆ¥ä¾¡æ ¼480å††ï¼‰
            </button>
            
            <div class="social-proof" style="margin-top: 20px;">
                â­ 98.7%ã®æ–¹ãŒã€Œäººç”ŸãŒå¤‰ã‚ã£ãŸã€ã¨å›ç­”
            </div>
        </div>
    </div>
    
    <script>
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        let userData = {
            name: '',
            birthDate: '',
            startTime: new Date(),
            step: 1
        };
        
        // å½ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã‚’å‹•çš„ã«å¤‰æ›´
        setInterval(() => {
            const users = document.getElementById('activeUsers');
            if (users) {
                const current = parseInt(users.textContent);
                const change = Math.floor(Math.random() * 50) - 25;
                users.textContent = Math.max(2000, current + change).toLocaleString();
            }
        }, 3000);
        
        // ã‚¹ãƒ†ãƒƒãƒ—1å‡¦ç†
        function processStep1() {
            const name = document.getElementById('userName').value;
            if (!name) {
                alert('ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            userData.name = name;
            localStorage.setItem('userData', JSON.stringify(userData));
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ¼”å‡º
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                showStep2(name);
            }, 3000);
        }
        
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        function showLoading() {
            document.getElementById('step1').classList.remove('active');
            document.getElementById('loading').classList.add('active');
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤‰æ›´
            const texts = [
                'å®‡å®™ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ä¸­...',
                'ã‚ãªãŸã®é‹å‘½ã‚’è§£æä¸­...',
                'å®ˆè­·éœŠã¨äº¤ä¿¡ä¸­...',
                'ç‰¹åˆ¥ãªçµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼'
            ];
            
            let index = 0;
            const interval = setInterval(() => {
                document.getElementById('loadingText').textContent = texts[index];
                index++;
                if (index >= texts.length) {
                    clearInterval(interval);
                }
            }, 700);
        }
        
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤º
        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }
        
        // ã‚¹ãƒ†ãƒƒãƒ—2è¡¨ç¤º
        function showStep2(name) {
            document.getElementById('step2').classList.add('active');
            document.getElementById('displayName').textContent = name;
            
            // ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            const messages = [
                `${name}æ§˜ã€å®Ÿã¯æ˜¨æ—¥ã‹ã‚‰ã‚ãªãŸã®ã“ã¨ãŒæ°—ã«ãªã£ã¦ã„ã¾ã—ãŸ...`,
                `${name}æ§˜ã«ä»Šã™ãä¼ãˆãªã‘ã‚Œã°ãªã‚‰ãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™...`,
                `${name}æ§˜ã®å‘¨ã‚Šã§å¤§ããªå¤‰åŒ–ãŒèµ·ãã‚ˆã†ã¨ã—ã¦ã„ã¾ã™...`
            ];
            
            const loveMessages = [
                'ç¾åœ¨ã€æ‹æ„›é‹ãŒæ€¥ä¸Šæ˜‡ä¸­ï¼',
                'é‹å‘½ã®äººã¨ã®å‡ºä¼šã„ãŒè¿‘ã¥ã„ã¦ã„ã¾ã™',
                'ä»Šæœˆã¯æ‹æ„›ã«ãŠã‘ã‚‹é‡è¦ãªè»¢æ©Ÿ'
            ];
            
            document.getElementById('previewMessage').textContent = 
                messages[Math.floor(Math.random() * messages.length)];
            
            document.getElementById('lovePreview').textContent = 
                loveMessages[Math.floor(Math.random() * loveMessages.length)];
            
            // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹
            startCountdown();
            
            // 30ç§’å¾Œã«ä¸å®‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            setTimeout(() => {
                showNotification('é‡è¦ï¼šæ˜æ—¥ã¾ã§ã«è¡Œå‹•ã—ãªã„ã¨é‹æ°—ãŒ...', 'warning');
            }, 30000);
        }
        
        // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒãƒ¼
        function startCountdown() {
            let seconds = 300; // 5åˆ†
            const timer = setInterval(() => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                const timerElement = document.getElementById('timer');
                if (timerElement) {
                    timerElement.textContent = 
                        `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                }
                
                seconds--;
                
                if (seconds < 0) {
                    clearInterval(timer);
                    const countdownElement = document.getElementById('countdown');
                    if (countdownElement) {
                        countdownElement.innerHTML = 
                            '<span style="color: #ff6b6b;">âš ï¸ æ™‚é–“åˆ‡ã‚Œï¼ç‰¹åˆ¥ã‚ªãƒ•ã‚¡ãƒ¼ãŒçµ‚äº†ã—ã¾ã—ãŸ</span>';
                    }
                }
            }, 1000);
        }
        
        // ã‚¹ãƒ†ãƒƒãƒ—2å‡¦ç†
        function processStep2() {
            const birthDate = document.getElementById('birthDate').value;
            if (!birthDate) {
                alert('ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            userData.birthDate = birthDate;
            userData.step = 3;
            localStorage.setItem('userData', JSON.stringify(userData));
            
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                showStep3();
            }, 3000);
        }
        
        // ã‚¹ãƒ†ãƒƒãƒ—3è¡¨ç¤º
        function showStep3() {
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.add('active');
            document.getElementById('finalName').textContent = userData.name;
            
            // ç·Šæ€¥æ€§ã®é«˜ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            const criticalMessages = [
                `${userData.name}æ§˜ã€ã“ã‚Œã¯å¶ç„¶ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä»Šã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª­ã‚“ã§ã„ã‚‹ã®ã«ã¯æ·±ã„æ„å‘³ãŒã‚ã‚Šã¾ã™ã€‚`,
                `å®Ÿã¯ã€${userData.name}æ§˜ã®é‹å‘½ã«é–¢ã‚ã‚‹é‡è¦ãªè»¢æ©ŸãŒè¨ªã‚Œã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€æ­£ã—ã„é¸æŠã‚’ã—ãªã„ã¨...`,
                `${userData.name}æ§˜ã®å®ˆè­·éœŠãŒå¼·ãè­¦å‘Šã—ã¦ã„ã¾ã™ã€‚ä»Šã™ãè¡Œå‹•ã‚’èµ·ã“ã•ãªã„ã¨ã€å¤§åˆ‡ãªãƒãƒ£ãƒ³ã‚¹ã‚’é€ƒã™ã“ã¨ã«...`
            ];
            
            document.getElementById('criticalMessage').textContent = 
                criticalMessages[Math.floor(Math.random() * criticalMessages.length)];
            
            // è©³ç´°ãªå ã„çµæœã‚’ç”Ÿæˆ
            generateDetailedFortune();
            
            // 60ç§’å¾Œã«æœŸå¾…ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            setTimeout(() => {
                showNotification('å®Ÿã¯ã€ã‚ãªãŸã®ã“ã¨ã‚’æƒ³ã£ã¦ã„ã‚‹äººãŒ...', 'hope');
            }, 60000);
        }
        
        // è©³ç´°ãªå ã„çµæœã‚’ç”Ÿæˆ
        function generateDetailedFortune() {
            const loveFortuneTexts = [
                `${userData.name}æ§˜ã®æ‹æ„›é‹ã¯ä»Šã€ç‰¹åˆ¥ãªè»¢æ©Ÿã‚’è¿ãˆã¦ã„ã¾ã™ã€‚ç‰¹ã«ä»Šæœˆã®15æ—¥å‰å¾Œã¯é‡è¦ãªå‡ºä¼šã„ã®å¯èƒ½æ€§ãŒ...`,
                `é‹å‘½ã®äººã¯ã™ãè¿‘ãã«ã„ã¾ã™ã€‚ãã®äººã®ç‰¹å¾´ã¯ã€å„ªã—ã„ç¬‘é¡”ã¨æ¸©ã‹ã„å¿ƒã‚’æŒã£ãŸ...`,
                `${userData.name}æ§˜ã®é­…åŠ›ãŒæœ€é«˜æ½®ã«é”ã—ã¦ã„ã¾ã™ã€‚ä»ŠãŒã‚¢ãƒ—ãƒ­ãƒ¼ãƒã®æœ€é«˜ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°...`
            ];
            
            const moneyFortuneTexts = [
                `é‡‘é‹ãŒæ€¥ä¸Šæ˜‡ä¸­ï¼ç‰¹ã«å®ãã˜ã‚„æ‡¸è³ã§ã®å½“é¸é‹ãŒ...è‡¨æ™‚åå…¥ã®å¯èƒ½æ€§ã‚‚...`,
                `ä»Šæœˆã¯æŠ•è³‡ã®ãƒãƒ£ãƒ³ã‚¹ã€‚ãŸã ã—ã€22æ—¥ã ã‘ã¯çµ¶å¯¾ã«å¤§ããªè²·ã„ç‰©ã‚’é¿ã‘ã¦...`,
                `${userData.name}æ§˜ã®æ‰èƒ½ãŒèªã‚ã‚‰ã‚Œã€åå…¥ã‚¢ãƒƒãƒ—ã®å¯èƒ½æ€§ãŒ...`
            ];
            
            document.getElementById('loveFortune').textContent = 
                loveFortuneTexts[Math.floor(Math.random() * loveFortuneTexts.length)];
            
            document.getElementById('moneyFortune').textContent = 
                moneyFortuneTexts[Math.floor(Math.random() * moneyFortuneTexts.length)];
        }
        
        // ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥é¢¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        function showNotification(message, type = 'warning') {
            const notification = document.createElement('div');
            notification.className = 'push-notification';
            notification.innerHTML = `
                <div class="notification-icon">${type === 'warning' ? 'âš ï¸' : 'âœ¨'}</div>
                <div class="notification-text">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }
        
        // æ±ºæ¸ˆå‡¦ç†
        function processPayment() {
            userData.converted = true;
            userData.conversionTime = new Date();
            localStorage.setItem('userData', JSON.stringify(userData));
            
            // æœ€åˆã®480å††æ±ºæ¸ˆã¸
            window.location.href = 'https://buy.stripe.com/test_aFa7sK5bP99E2pF8BUcV200';
        }
        
        // é›¢è„±é˜²æ­¢ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
        let exitIntentShown = false;
        document.addEventListener('mouseleave', (e) => {
            if (e.clientY <= 0 && !exitIntentShown && userData.step > 1 && !userData.converted) {
                exitIntentShown = true;
                showExitPopup();
            }
        });
        
        function showExitPopup() {
            const popup = document.createElement('div');
            popup.className = 'exit-popup';
            popup.innerHTML = `
                <div class="exit-popup-content">
                    <h2>ğŸ˜± ã¡ã‚‡ã£ã¨å¾…ã£ã¦ï¼</h2>
                    <p class="exit-main-message">
                        ${userData.name}æ§˜ã®é‹å‘½ã®è»¢æ©Ÿã¾ã§<br>
                        <span class="countdown-large">ã‚ã¨12æ™‚é–“</span>
                    </p>
                    <div class="exit-warning">
                        âš ï¸ ä»Šé›¢ã‚Œã‚‹ã¨ã€ã“ã®ç‰¹åˆ¥ãªè¨ºæ–­çµæœã¯äºŒåº¦ã¨è¦‹ã‚‰ã‚Œã¾ã›ã‚“
                    </div>
                    <div class="exit-offer">
                        <div class="offer-badge">æœ€å¾Œã®ãƒãƒ£ãƒ³ã‚¹</div>
                        <div class="offer-price">
                            <span class="original-price">é€šå¸¸4,800å††</span>
                            <span class="arrow">â†’</span>
                            <span class="special-price">ä»Šã ã‘480å††</span>
                        </div>
                    </div>
                    <button class="exit-cta" onclick="acceptExitOffer()">
                        é‹å‘½ã‚’ç¢ºèªã™ã‚‹ï¼ˆ90%OFFï¼‰
                    </button>
                    <button class="exit-close" onclick="closeExitPopup()">
                        æœ¬å½“ã«è«¦ã‚ã‚‹
                    </button>
                </div>
            `;
            
            document.body.appendChild(popup);
            setTimeout(() => popup.classList.add('show'), 100);
        }
        
        function acceptExitOffer() {
            closeExitPopup();
            processPayment();
        }
        
        function closeExitPopup() {
            const popup = document.querySelector('.exit-popup');
            if (popup) {
                popup.classList.remove('show');
                setTimeout(() => popup.remove(), 300);
            }
        }
        
        // ãƒ›ãƒ¼ãƒ ç”»é¢è¿½åŠ ã®èª˜å°
        function showAddToHomeScreen() {
            // iOSã®å ´åˆ
            if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
                const popup = document.createElement('div');
                popup.className = 'add-to-home-popup';
                popup.innerHTML = `
                    <div class="add-to-home-content">
                        <h3>ğŸ“± ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ãˆã¾ã™ï¼</h3>
                        <p>ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã™ã‚‹ã¨ã€ã„ã¤ã§ã‚‚ã™ãã«å ãˆã¾ã™âœ¨</p>
                        <ol>
                            <li>ä¸‹ã®å…±æœ‰ãƒœã‚¿ãƒ³ï¼»â¬†ï¼½ã‚’ã‚¿ãƒƒãƒ—</li>
                            <li>ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’é¸æŠ</li>
                            <li>ã€Œè¿½åŠ ã€ã‚’ã‚¿ãƒƒãƒ—</li>
                        </ol>
                        <button onclick="this.parentElement.parentElement.remove()">å¾Œã§</button>
                    </div>
                `;
                document.body.appendChild(popup);
            }
            // Androidã®å ´åˆ
            else if (/Android/.test(navigator.userAgent)) {
                const popup = document.createElement('div');
                popup.className = 'add-to-home-popup';
                popup.innerHTML = `
                    <div class="add-to-home-content">
                        <h3>ğŸ“± ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ãˆã¾ã™ï¼</h3>
                        <p>ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã™ã‚‹ã¨ã€ã„ã¤ã§ã‚‚ã™ãã«å ãˆã¾ã™âœ¨</p>
                        <ol>
                            <li>å³ä¸Šã®ï¼»â‹®ï¼½ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚¿ãƒƒãƒ—</li>
                            <li>ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’é¸æŠ</li>
                        </ol>
                        <button onclick="this.parentElement.parentElement.remove()">å¾Œã§</button>
                    </div>
                `;
                document.body.appendChild(popup);
            }
        }

        // 3å›ç›®ã®è¨ªå•ã§è¡¨ç¤º
        let visitCount = localStorage.getItem('visitCount') || 0;
        visitCount++;
        localStorage.setItem('visitCount', visitCount);
        if (visitCount === 3) {
            setTimeout(showAddToHomeScreen, 5000);
        }
        
        // é›¢è„±é˜²æ­¢
        window.addEventListener('beforeunload', (e) => {
            if (userData.step > 1 && !userData.converted) {
                e.preventDefault();
                e.returnValue = 'æœ¬å½“ã«é›¢ã‚Œã¾ã™ã‹ï¼Ÿç‰¹åˆ¥ãªè¨ºæ–­çµæœãŒæ¶ˆãˆã¦ã—ã¾ã„ã¾ã™...';
            }
        });
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('userData');
            if (saved) {
                userData = JSON.parse(saved);
                // å‰å›ã®ç¶šãã‹ã‚‰é–‹å§‹
                if (userData.step === 2) {
                    document.getElementById('step1').classList.remove('active');
                    showStep2(userData.name);
                } else if (userData.step === 3) {
                    document.getElementById('step1').classList.remove('active');
                    showStep3();
                }
            }
        });
    </script>
</body>
</html>
