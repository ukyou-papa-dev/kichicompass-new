うきょう君パパさん、収益最大化システムの実装、承知しました！

**現在の進捗: 75%** | 残り15日 | 月30万まであと22.5万円

## 🎯 今日の3タスク（優先順）

### 1. コード統合作業（30分）
提供されたコードを既存HTMLに正確に挿入します。

### 2. 価格フロー最適化（20分）
480円→1,980円→4,980円の段階的アップセル実装

### 3. テスト＆調整（10分）
動作確認と収益最大化ポイントの確認

---

## 📝 実装コード（完成版）

以下が統合済みの完全なコードです：

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>【的中率98.7%】KichiCompass 無料占い - あなたの運命が今明らかに</title>
    <meta name="description" content="驚異の的中率98.7%！3万人が体験した本格占い。恋愛・金運・健康運を完全無料で診断。今なら特別価格でプレミアム診断も。">
    
    <!-- ファビコン・PWAアイコン設定 -->
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-512.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-512.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon-512.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon-512.png">
    
    <!-- マニフェスト -->
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS用の追加設定 -->
    <meta name="apple-mobile-web-app-title" content="KichiCompass">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- Android用の追加設定 -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- OGP設定 -->
    <meta property="og:title" content="【無料】あなたの運命を占います - KichiCompass">
    <meta property="og:description" content="3分で分かる！あなたの運命を無料診断">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://ukyou-papa-dev.github.io/KichiCompass/icon-512.png">
    <meta property="og:url" content="https://ukyou-papa-dev.github.io/KichiCompass/">
    
    <!-- テーマカラー -->
    <meta name="theme-color" content="#667eea">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XENJ6H8FDN"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XENJ6H8FDN');
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            position: relative;
        }

        /* 背景のキラキラエフェクト */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            animation: shimmer 20s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* 浮遊する星 */
        .floating-stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }

        .star {
            position: absolute;
            color: rgba(255, 255, 255, 0.8);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        /* 固定ヘッダー */
        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, #ff6b6b, #ff8e53);
            padding: 10px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            animation: pulse-bg 2s ease-in-out infinite;
        }

        @keyframes pulse-bg {
            0%, 100% { background: linear-gradient(90deg, #ff6b6b, #ff8e53); }
            50% { background: linear-gradient(90deg, #ff8e53, #ffd93d); }
        }

        .countdown-timer {
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .timer-number {
            background: rgba(0,0,0,0.3);
            padding: 2px 8px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 16px;
        }

        /* ステップ */
        .step {
            display: none;
            animation: slideIn 0.5s ease-out;
            padding-top: 60px;
        }

        .step.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* メインタイトル */
        .main-title {
            text-align: center;
            margin: 30px 0;
            position: relative;
        }

        .title-emoji {
            font-size: 60px;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .title-text {
            font-size: 28px;
            font-weight: 900;
            margin: 20px 0;
            text-shadow: 
                0 0 10px rgba(255,255,255,0.5),
                0 0 20px rgba(255,255,255,0.3),
                0 0 30px rgba(255,255,255,0.2);
            animation: glow-text 2s ease-in-out infinite;
        }

        @keyframes glow-text {
            0%, 100% { 
                text-shadow: 
                    0 0 10px rgba(255,255,255,0.5),
                    0 0 20px rgba(255,255,255,0.3),
                    0 0 30px rgba(255,255,255,0.2);
            }
            50% { 
                text-shadow: 
                    0 0 20px rgba(255,255,255,0.8),
                    0 0 30px rgba(255,255,255,0.6),
                    0 0 40px rgba(255,255,255,0.4);
            }
        }

        .subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-top: 10px;
        }

        /* ソーシャルプルーフ */
        .social-proof-container {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .user-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 18px;
        }

        .live-dot {
            width: 10px;
            height: 10px;
            background: #00ff00;
            border-radius: 50%;
            animation: live-pulse 1.5s ease-in-out infinite;
        }

        @keyframes live-pulse {
            0%, 100% { 
                opacity: 1;
                box-shadow: 0 0 0 0 rgba(0,255,0,0.7);
            }
            50% { 
                opacity: 0.5;
                box-shadow: 0 0 0 10px rgba(0,255,0,0);
            }
        }

        .user-count {
            color: #ffd700;
            font-weight: bold;
            font-size: 24px;
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
        }

        /* 入力フィールド */
        .input-container {
            margin: 30px 0;
        }

        .input-label {
            display: block;
            margin-bottom: 10px;
            font-size: 14px;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .required-badge {
            background: #ff6b6b;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
        }

        .input-field {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 15px;
            background: rgba(255,255,255,0.95);
            color: #333;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .input-field:focus {
            outline: none;
            transform: translateY(-2px);
            box-shadow: 
                0 8px 25px rgba(0,0,0,0.3),
                0 0 0 3px rgba(255,215,0,0.5);
        }

        .input-field::placeholder {
            color: #999;
        }

        /* CTAボタン */
        .cta-button {
            width: 100%;
            padding: 20px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
            font-size: 18px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 
                0 10px 25px rgba(255,165,0,0.4),
                inset 0 1px 0 rgba(255,255,255,0.4);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .cta-button:hover::before {
            left: 100%;
        }

        .cta-button:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 
                0 15px 35px rgba(255,165,0,0.5),
                inset 0 1px 0 rgba(255,255,255,0.4);
        }

        .cta-button:active {
            transform: translateY(0) scale(1);
        }

        /* 緊急バナー */
        .urgency-banner {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            padding: 12px;
            text-align: center;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(255,107,107,0.3);
        }

        .urgency-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255,255,255,0.1) 50%,
                transparent 70%
            );
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .urgency-text {
            position: relative;
            z-index: 1;
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* 占術選択グリッド */
        .fortune-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .fortune-option {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            border: 2px solid transparent;
            backdrop-filter: blur(10px);
        }

        .fortune-option:hover {
            transform: translateY(-5px) scale(1.05);
            background: rgba(255,255,255,0.2);
            border-color: #ffd700;
            box-shadow: 0 10px 30px rgba(255,215,0,0.3);
        }

        .fortune-option.special {
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2));
            border-color: #ffd700;
        }

        .fortune-icon {
            font-size: 40px;
            margin-bottom: 10px;
            animation: icon-float 3s ease-in-out infinite;
        }

        @keyframes icon-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .fortune-name {
            font-size: 16px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .fortune-description {
            font-size: 12px;
            opacity: 0.9;
            line-height: 1.4;
        }

        .fortune-badge {
            position: absolute;
            top: -10px;
            right: 10px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        .special-badge {
            background: linear-gradient(45deg, #ffd700, #ffa500);
            animation: badge-pulse 1s ease-in-out infinite;
        }

        @keyframes badge-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* ローディング */
        .loading-container {
            display: none;
            text-align: center;
            padding: 60px 20px;
        }

        .loading-container.active {
            display: block;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            margin: 0 auto 30px;
            position: relative;
        }

        .loading-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 4px solid rgba(255,255,255,0.2);
            border-radius: 50%;
        }

        .loading-ring:nth-child(1) {
            border-top-color: #ffd700;
            animation: spin 1s linear infinite;
        }

        .loading-ring:nth-child(2) {
            border-right-color: #ff6b6b;
            animation: spin 1.5s linear infinite reverse;
            width: 60px;
            height: 60px;
            top: 10px;
            left: 10px;
        }

        .loading-ring:nth-child(3) {
            border-bottom-color: #4ecdc4;
            animation: spin 2s linear infinite;
            width: 40px;
            height: 40px;
            top: 20px;
            left: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-messages {
            margin-top: 20px;
        }

        .loading-message {
            font-size: 18px;
            margin: 10px 0;
            opacity: 0;
            animation: fadeInOut 1s ease-in-out;
        }

        .loading-message.active {
            opacity: 1;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(10px); }
            50% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }

        /* 結果カード */
        .result-card {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4, #ffd700);
            border-radius: 20px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s;
        }

        .result-card:hover::before {
            opacity: 1;
            animation: gradient-border 3s linear infinite;
        }

        @keyframes gradient-border {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .result-icon {
            font-size: 30px;
            animation: icon-glow 2s ease-in-out infinite;
        }

        @keyframes icon-glow {
            0%, 100% { filter: drop-shadow(0 0 5px rgba(255,255,255,0.5)); }
            50% { filter: drop-shadow(0 0 15px rgba(255,255,255,0.8)); }
        }

        .result-title {
            font-size: 20px;
            font-weight: bold;
            color: #ffd700;
        }

        .result-content {
            line-height: 1.8;
            font-size: 16px;
        }

        /* 占術結果スタイル */
        .fortune-detail {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .fortune-detail h4 {
            color: #ffd700;
            margin: 10px 0 5px;
            font-size: 16px;
        }

        .tarot-spread {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .tarot-position {
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        .card-name {
            color: #ffd700;
            font-weight: bold;
            margin: 5px 0;
        }

        .card-meaning {
            font-size: 12px;
            opacity: 0.9;
        }

        .numerology-result,
        .animal-result,
        .shichu-result {
            padding: 15px;
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
            margin-top: 15px;
        }

        .comprehensive-result .result-card {
            margin: 30px 0;
        }

        /* ぼかし効果 */
        .blur-container {
            position: relative;
            margin: 20px 0;
        }

        .blur-content {
            filter: blur(8px);
            user-select: none;
            padding: 20px;
        }

        .unlock-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 20px 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .unlock-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .unlock-text {
            font-size: 16px;
            margin-bottom: 15px;
        }

        .unlock-button {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .unlock-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255,215,0,0.5);
        }

        /* プログレスバー */
        .progress-container {
            margin: 30px 0;
        }

        .progress-label {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            height: 8px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ff6b6b);
            border-radius: 10px;
            transition: width 0.5s ease-out;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255,255,255,0.3),
                transparent
            );
            animation: progress-shine 2s linear infinite;
        }

        @keyframes progress-shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-percentage {
            text-align: right;
            font-size: 12px;
            margin-top: 5px;
            color: #ffd700;
            font-weight: bold;
        }

        /* 評価星 */
        .rating-container {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 20px 0;
        }

        .rating-star {
            color: #ffd700;
            font-size: 24px;
            animation: star-twinkle 1s ease-in-out infinite;
        }

        .rating-star:nth-child(1) { animation-delay: 0s; }
        .rating-star:nth-child(2) { animation-delay: 0.2s; }
        .rating-star:nth-child(3) { animation-delay: 0.4s; }
        .rating-star:nth-child(4) { animation-delay: 0.6s; }
        .rating-star:nth-child(5) { animation-delay: 0.8s; }

        @keyframes star-twinkle {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        /* 通知ポップアップ */
        .notification-popup {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            color: #333;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            transform: translateX(-400px);
            transition: transform 0.3s ease-out;
            z-index: 1000;
            max-width: 300px;
        }

        .notification-popup.show {
            transform: translateX(0);
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .notification-icon {
            width: 30px;
            height: 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .notification-title {
            font-weight: bold;
            font-size: 14px;
        }

        .notification-message {
            font-size: 13px;
            color: #666;
        }

        /* フローティングアクションボタン */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            box-shadow: 0 5px 20px rgba(255,107,107,0.4);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 100;
            animation: fab-pulse 2s ease-in-out infinite;
        }

        @keyframes fab-pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 5px 20px rgba(255,107,107,0.4);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 8px 30px rgba(255,107,107,0.6);
            }
        }

        .fab:hover {
            transform: scale(1.15) rotate(15deg);
        }

        /* 特別オファーモーダル */
        .special-offer-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .special-offer-modal.show {
            opacity: 1;
            pointer-events: all;
        }

        .special-offer-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            color: #333;
            position: relative;
            animation: modal-bounce 0.5s ease-out;
        }

        @keyframes modal-bounce {
            0% { transform: scale(0.8) translateY(50px); opacity: 0; }
            80% { transform: scale(1.05) translateY(-10px); }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }

        .offer-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 30px;
            height: 30px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .offer-close:hover {
            background: #ff6b6b;
            color: white;
            transform: rotate(90deg);
        }

        .offer-title {
            font-size: 28px;
            color: #ff6b6b;
            margin-bottom: 20px;
            font-weight: 900;
        }

        .offer-countdown {
            font-size: 36px;
            color: #333;
            font-weight: bold;
            margin: 20px 0;
            font-family: monospace;
        }

        .offer-price {
            margin: 20px 0;
        }

        .offer-original {
            text-decoration: line-through;
            color: #999;
            font-size: 18px;
        }

        .offer-discount {
            font-size: 48px;
            color: #ff6b6b;
            font-weight: 900;
            margin: 10px 0;
        }

        .offer-final {
            font-size: 32px;
            color: #333;
            font-weight: bold;
        }

        .offer-cta {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
            width: 100%;
        }

        .offer-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255,107,107,0.4);
        }

        /* ポイントシステムのスタイル */
        .point-modal, .vip-modal, .personal-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 20000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .point-modal-content, .vip-modal-content, .personal-modal-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.5s;
        }

        .point-header, .vip-header, .personal-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .point-header h2 {
            font-size: 28px;
            margin: 0;
        }

        .close-point, .close-vip, .close-personal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            color: white;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .close-point:hover {
            transform: rotate(90deg);
        }

        .point-balance {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
        }

        .current-points {
            font-size: 36px;
            font-weight: bold;
            color: #FFD700;
            margin-top: 10px;
        }

        .point-packages {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .point-package {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            text-align: center;
        }

        .point-package:hover {
            transform: translateY(-5px);
            border-color: #FFD700;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }

        .point-package.popular {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.1);
        }

        .point-package.best {
            border-color: #FF6B6B;
            background: rgba(255, 107, 107, 0.1);
        }

        .point-package.vip {
            grid-column: span 2;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 107, 107, 0.2));
            border-color: #FFD700;
        }

        .package-points {
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .package-price {
            font-size: 28px;
            color: #FFD700;
            margin: 10px 0;
            font-weight: bold;
        }

        .original-price {
            text-decoration: line-through;
            color: rgba(255, 255, 255, 0.5);
            font-size: 18px;
            display: block;
        }

        .discount-badge {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            position: absolute;
            top: -10px;
            right: 10px;
        }

        .package-badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            margin-top: 10px;
            display: inline-block;
        }

        .bonus-text {
            color: #FFD700;
            font-size: 14px;
            margin-top: 10px;
            font-weight: bold;
        }

        .point-benefits {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
        }

        .point-benefits h3 {
            color: #FFD700;
            margin-bottom: 15px;
        }

        .point-benefits ul {
            list-style: none;
            padding: 0;
        }

        .point-benefits li {
            color: white;
            margin: 10px 0;
            padding-left: 25px;
        }

        /* VIPプランのスタイル */
        .vip-crown {
            font-size: 60px;
            animation: bounce 2s infinite;
        }

        .vip-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .plan-column {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            position: relative;
        }

        .plan-column.vip-plan {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
            border: 2px solid #FFD700;
            transform: scale(1.05);
        }

        .recommended-badge {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
            padding: 5px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .plan-column h3 {
            text-align: center;
            color: #FFD700;
            margin-bottom: 20px;
        }

        .plan-column ul {
            list-style: none;
            padding: 0;
        }

        .plan-column li {
            margin: 15px 0;
            color: white;
        }

        .plan-column li.no {
            opacity: 0.5;
        }

        .plan-column li.yes {
            color: #90EE90;
            font-weight: bold;
        }

        .plan-price {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .price-main {
            font-size: 28px;
            color: #FFD700;
            font-weight: bold;
            display: block;
        }

        .price-sub {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            display: block;
            margin-top: 5px;
        }

        .vip-cta {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .vip-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
        }

        .vip-testimonials {
            margin: 30px 0;
        }

        .vip-testimonials h3 {
            color: #FFD700;
            text-align: center;
            margin-bottom: 20px;
        }

        .testimonial {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .testimonial p {
            color: white;
            font-style: italic;
            margin-bottom: 10px;
        }

        .testimonial span {
            color: #FFD700;
            font-size: 12px;
        }

        .limited-time {
            text-align: center;
            background: rgba(255, 107, 107, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }

        .limited-time span {
            color: #FFD700;
            font-size: 24px;
            font-weight: bold;
        }

        .close-vip {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .close-vip:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* 個人鑑定のスタイル */
        .personal-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .personal-features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .feature {
            text-align: center;
        }

        .feature-icon {
            font-size: 40px;
            display: block;
            margin-bottom: 10px;
        }

        .feature h3 {
            color: #FFD700;
            font-size: 16px;
            margin: 10px 0;
        }

        .feature p {
            color: white;
            font-size: 12px;
            opacity: 0.9;
        }

        .personal-pricing {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid #FFD700;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 30px 0;
        }

        .price-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .original-personal-price {
            text-decoration: line-through;
            color: rgba(255, 255, 255, 0.5);
            font-size: 24px;
        }

        .special-personal-price {
            font-size: 48px;
            color: #FFD700;
            font-weight: bold;
        }

        .savings {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }

        .urgency-message {
            background: rgba(255, 107, 107, 0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin: 20px 0;
        }

        .urgency-message p {
            color: white;
            margin: 5px 0;
        }

        .slots-remaining {
            color: #FFD700;
            font-weight: bold;
            font-size: 20px;
        }

        .personal-cta {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
            border: none;
            padding: 20px;
            border-radius: 30px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            animation: pulse 2s infinite;
        }

        .personal-cta:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.5);
        }

        .close-personal {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px;
            border-radius: 20px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }

        /* ポイント表示バー */
        .points-bar {
            position: fixed;
            top: 60px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 30px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s;
        }

        .points-bar:hover {
            transform: scale(1.05);
            background: rgba(0, 0, 0, 0.9);
        }

        .points-icon {
            font-size: 20px;
        }

        .points-amount {
            color: #FFD700;
            font-weight: bold;
            font-size: 18px;
        }

        .add-points-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
            border: none;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* レスポンシブ */
        @media (max-width: 768px) {
            .point-packages {
                grid-template-columns: 1fr;
            }
            
            .point-package.vip {
                grid-column: span 1;
            }
            
            .personal-features {
                grid-template-columns: 1fr;
            }
            
            .vip-comparison {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .title-text {
                font-size: 24px;
            }
            
            .container {
                padding: 15px;
            }
            
            .notification-popup {
                left: 10px;
                right: 10px;
                max-width: none;
            }

            .tarot-spread {
                grid-template-columns: 1fr;
            }
        }

        /* PWA専用スタイル */
        @media (display-mode: standalone) {
            body {
                padding-top: 40px;
            }
        }

        /* アニメーション */
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
    </style>
</head>
<body>
    <!-- 浮遊する星 -->
    <div class="floating-stars">
        <span class="star" style="top: 10%; left: 20%; font-size: 20px; animation-delay: 0s;">✨</span>
        <span class="star" style="top: 30%; left: 80%; font-size: 16px; animation-delay: 1s;">⭐</span>
        <span class="star" style="top: 60%; left: 10%; font-size: 24px; animation-delay: 2s;">🌟</span>
        <span class="star" style="top: 80%; left: 70%; font-size: 18px; animation-delay: 3s;">✨</span>
        <span class="star" style="top: 40%; left: 50%; font-size: 22px; animation-delay: 4s;">⭐</span>
    </div>

    <!-- 固定ヘッダー -->
    <div class="fixed-header">
        <div class="countdown-timer">
            <span>⚡ 初回90%OFF終了まで</span>
            <span class="timer-number" id="hours">00</span>
            <span>:</span>
            <span class="timer-number" id="minutes">00</span>
            <span>:</span>
            <span class="timer-number" id="seconds">00</span>
        </div>
    </div>

    <div class="container">
        <!-- ステップ1: 初期画面 -->
        <div class="step active" id="step1">
            <div class="main-title">
                <div class="title-emoji">🔮</div>
                <h1 class="title-text">あなたの運命が呼んでいます</h1>
                <p class="subtitle">3万人が体験した驚異の的中率98.7%</p>
            </div>

            <div class="social-proof-container">
                <div class="user-counter">
                    <div class="live-dot"></div>
                    <span>現在</span>
                    <span class="user-count" id="activeUsers">2,847</span>
                    <span>人が鑑定中</span>
                </div>
            </div>

            <div class="rating-container">
                <span class="rating-star">⭐</span>
                <span class="rating-star">⭐</span>
                <span class="rating-star">⭐</span>
                <span class="rating-star">⭐</span>
                <span class="rating-star">⭐</span>
            </div>

            <div class="input-container">
                <label class="input-label">
                    お名前
                    <span class="required-badge">必須</span>
                </label>
                <input type="text" class="input-field" id="userName" placeholder="ニックネームでもOK" autocomplete="off">
            </div>

            <button class="cta-button" onclick="processStep1()">
                無料で運命を確認する
            </button>

            <div class="urgency-banner">
                <div class="urgency-text">⚡ 本日限定！通常4,800円→完全無料 ⚡</div>
            </div>

            <div class="progress-container">
                <div class="progress-label">本日の無料診断枠</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 87%"></div>
                </div>
                <div class="progress-percentage">残り13%</div>
            </div>
        </div>

        <!-- 占術選択画面 -->
        <div class="step" id="fortuneSelection">
            <div class="main-title">
                <h2 class="title-text">✨ <span id="userName2"></span>様の占術を選択 ✨</h2>
                <p class="subtitle">あなたに最適な占術で運命を解き明かします</p>
            </div>

            <div class="fortune-grid">
                <div class="fortune-option" onclick="selectFortune('astrology')">
                    <div class="fortune-icon">⭐</div>
                    <h3 class="fortune-name">西洋占星術</h3>
                    <p class="fortune-description">12星座と惑星の配置から運命を読み解く</p>
                    <div class="fortune-badge">人気No.1</div>
                </div>

                <div class="fortune-option" onclick="selectFortune('tarot')">
                    <div class="fortune-icon">🎴</div>
                    <h3 class="fortune-name">タロット占い</h3>
                    <p class="fortune-description">78枚のカードが示す深層心理と未来</p>
                    <div class="fortune-badge">的中率98%</div>
                </div>

                <div class="fortune-option" onclick="selectFortune('numerology')">
                    <div class="fortune-icon">🔢</div>
                    <h3 class="fortune-name">数秘術</h3>
                    <p class="fortune-description">生年月日から導く運命の数字</p>
                    <div class="fortune-badge">恋愛特化</div>
                </div>

                <div class="fortune-option" onclick="selectFortune('animal')">
                    <div class="fortune-icon">🐾</div>
                    <h3 class="fortune-name">動物占い</h3>
                    <p class="fortune-description">12の動物キャラで性格と相性を診断</p>
                    <div class="fortune-badge">相性診断</div>
                </div>

                <div class="fortune-option" onclick="selectFortune('shichu')">
                    <div class="fortune-icon">🐉</div>
                    <h3 class="fortune-name">四柱推命</h3>
                    <p class="fortune-description">東洋最高峰の的中率を誇る運命学</p>
                    <div class="fortune-badge">プロ推奨</div>
                </div>

                <div class="fortune-option special" onclick="selectFortune('all')">
                    <div class="fortune-icon">👑</div>
                    <h3 class="fortune-name">総合鑑定</h3>
                    <p class="fortune-description">全ての占術を組み合わせた完全診断</p>
                    <div class="fortune-badge special-badge">限定</div>
                </div>
            </div>
        </div>

        <!-- ローディング -->
        <div class="loading-container" id="loading">
            <div class="loading-spinner">
                <div class="loading-ring"></div>
                <div class="loading-ring"></div>
                <div class="loading-ring"></div>
            </div>
            <div class="loading-messages">
                <div class="loading-message" id="loadingText">宇宙からメッセージを受信中...</div>
            </div>
        </div>

        <!-- ステップ2: 詳細入力 -->
        <div class="step" id="step2">
            <div class="main-title">
                <h2 class="title-text">🌟 <span id="displayName"></span>様の運命 🌟</h2>
            </div>

            <div class="result-card">
                <div class="result-header">
                    <span class="result-icon">⚡</span>
                    <span class="result-title">緊急メッセージ</span>
                </div>
                <div class="result-content" id="previewMessage"></div>
            </div>

            <div class="result-card">
                <div class="result-header">
                    <span class="result-icon">💕</span>
                    <span class="result-title">恋愛運の詳細</span>
                </div>
                <div class="result-content">
                    <p id="lovePreview"></p>
                    <div class="blur-container">
                        <div class="blur-content">
                            実は、あなたのことを密かに想っている人が3人います。
                            その中の1人は、あなたもよく知っている...
                        </div>
                        <div class="unlock-overlay">
                            <div class="unlock-icon">🔒</div>
                            <div class="unlock-text">詳細を見るには生年月日が必要です</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="input-container">
                <label class="input-label">
                    生年月日
                    <span class="required-badge">必須</span>
                </label>
                <input type="date" class="input-field" id="birthDate">
            </div>

            <button class="cta-button" onclick="processStep2()">
                完全版を今すぐ確認する
            </button>
        </div>

        <!-- ステップ3: 最終結果 -->
        <div class="step" id="step3">
            <div class="main-title">
                <h2 class="title-text">⚠️ 重要な警告 ⚠️</h2>
            </div>

            <div class="result-card">
                <div class="result-header">
                    <span class="result-icon">🔮</span>
                    <span class="result-title"><span id="finalName"></span>様への特別メッセージ</span>
                </div>
                <div class="result-content" id="criticalMessage"></div>
            </div>

            <!-- 占術結果表示エリア -->
            <div id="fortuneResultArea"></div>

            <div class="result-card">
                <div class="result-header">
                    <span class="result-icon">💕</span>
                    <span class="result-title">恋愛運の真実</span>
                </div>
                <div class="result-content" id="loveFortune"></div>
            </div>

            <div class="result-card">
                <div class="result-header">
                    <span class="result-icon">💰</span>
                    <span class="result-title">金運の転機</span>
                </div>
                <div class="result-content" id="moneyFortune"></div>
            </div>

            <div class="blur-container">
                <div class="blur-content">
                    <div class="result-card">
                        <div class="result-header">
                            <span class="result-icon">⚠️</span>
                            <span class="result-title">絶対に避けるべき日</span>
                        </div>
                        <div class="result-content">
                            今月の●日は絶対に重要な決断をしてはいけません。
                            この日に行動すると...
                        </div>
                    </div>
                </div>
                <div class="unlock-overlay">
                    <div class="unlock-icon">🔓</div>
                    <div class="unlock-text">続きを読む</div>
                    <button class="unlock-button" onclick="processPayment()">
                        今だけ480円で解放
                    </button>
                </div>
            </div>

            <button class="cta-button" onclick="processPayment()">
                完全な診断結果を見る（特別価格480円）
            </button>

            <div class="social-proof-container">
                <p>⭐ 98.7%の方が「人生が変わった」と回答</p>
            </div>
        </div>
    </div>

    <!-- フローティングアクションボタン -->
    <div class="fab" onclick="showSpecialOffer()">
        🎁
    </div>

    <!-- 特別オファーモーダル -->
    <div class="special-offer-modal" id="specialOfferModal">
        <div class="special-offer-content">
            <div class="offer-close" onclick="closeSpecialOffer()">✕</div>
            <h2 class="offer-title">😱 ちょっと待って！</h2>
            <p>今だけの特別オファー</p>
            <div class="offer-countdown" id="offerCountdown">00:05:00</div>
            <div class="offer-price">
                <div class="offer-original">通常価格 ¥4,800</div>
                <div class="offer-discount">90% OFF</div>
                <div class="offer-final">¥480</div>
            </div>
            <button class="offer-cta" onclick="processPayment()">
                今すぐ特別価格で始める
            </button>
        </div>
    </div>

    <!-- ポイント購入システム -->
    <div id="pointSystemModal" class="point-modal" style="display: none;">
        <div class="point-modal-content">
            <div class="point-header">
                <h2>💎 ポイント購入</h2>
                <span class="close-point" onclick="closePointModal()">&times;</span>
            </div>
            
            <div class="point-balance">
                <p>現在の保有ポイント</p>
                <div class="current-points">
                    <span id="userPoints">0</span> pt
                </div>
            </div>
            
            <div class="point-packages">
                <div class="point-package" onclick="purchasePoints(1000, 1000)">
                    <div class="package-header">
                        <span class="package-points">1,000pt</span>
                    </div>
                    <div class="package-price">¥1,000</div>
                    <div class="package-badge">スタンダード</div>
                </div>
                
                <div class="point-package popular" onclick="purchasePoints(5000, 4500)">
                    <div class="package-header">
                        <span class="package-points">5,000pt</span>
                        <span class="discount-badge">10%お得！</span>
                    </div>
                    <div class="package-price">
                        <span class="original-price">¥5,000</span>
                        ¥4,500
                    </div>
                    <div class="package-badge">人気No.1</div>
                </div>
                
                <div class="point-package best" onclick="purchasePoints(10000, 8000)">
                    <div class="package-header">
                        <span class="package-points">10,000pt</span>
                        <span class="discount-badge">20%お得！</span>
                    </div>
                    <div class="package-price">
                        <span class="original-price">¥10,000</span>
                        ¥8,000
                    </div>
                    <div class="package-badge">ベストバリュー</div>
                </div>
                
                <div class="point-package vip" onclick="purchasePoints(30000, 21000)">
                    <div class="package-header">
                        <span class="package-points">30,000pt</span>
                        <span class="discount-badge">30%お得！</span>
                    </div>
                    <div class="package-price">
                        <span class="original-price">¥30,000</span>
                        ¥21,000
                    </div>
                    <div class="package-badge">VIP限定</div>
                    <div class="bonus-text">+個人鑑定1回無料！</div>
                </div>
            </div>
            
            <div class="point-benefits">
                <h3>ポイントで出来ること</h3>
                <ul>
                    <li>🔮 特別鑑定の解放（500pt〜）</li>
                    <li>💕 相性診断（1,000pt）</li>
                    <li>📅 1年間の詳細運勢（3,000pt）</li>
                    <li>👤 個人鑑定の予約（10,000pt）</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- VIP月額プランモーダル -->
    <div id="vipPlanModal" class="vip-modal" style="display: none;">
        <div class="vip-modal-content">
            <div class="vip-header">
                <div class="vip-crown">👑</div>
                <h1>VIP会員へのご招待</h1>
                <p>特別なあなただけの限定オファー</p>
            </div>
            
            <div class="vip-comparison">
                <div class="plan-column regular">
                    <h3>通常会員</h3>
                    <ul>
                        <li class="no">❌ 月3回まで</li>
                        <li class="no">❌ 基本占術のみ</li>
                        <li class="no">❌ 24時間後に結果</li>
                        <li class="no">❌ 広告表示あり</li>
                    </ul>
                    <div class="plan-price">都度課金</div>
                </div>
                
                <div class="plan-column vip-plan">
                    <div class="recommended-badge">圧倒的にお得！</div>
                    <h3>VIP会員</h3>
                    <ul>
                        <li class="yes">✅ 無制限利用</li>
                        <li class="yes">✅ 全占術使い放題</li>
                        <li class="yes">✅ 即時結果表示</li>
                        <li class="yes">✅ 広告完全非表示</li>
                        <li class="yes">✅ 専属占い師サポート</li>
                        <li class="yes">✅ 毎月5,000pt付与</li>
                    </ul>
                    <div class="plan-price">
                        <span class="price-main">月額 ¥4,980</span>
                        <span class="price-sub">（1日あたり166円）</span>
                    </div>
                    <button class="vip-cta" onclick="subscribeVIP()">
                        今すぐVIP会員になる
                    </button>
                </div>
            </div>
            
            <div class="vip-testimonials">
                <h3>VIP会員様の声</h3>
                <div class="testimonial">
                    <p>"毎日占いができて、人生が変わりました！"</p>
                    <span>- 東京都 M様（VIP歴6ヶ月）</span>
                </div>
                <div class="testimonial">
                    <p>"専属占い師のアドバイスで彼と復縁できました"</p>
                    <span>- 大阪府 Y様（VIP歴3ヶ月）</span>
                </div>
            </div>
            
            <div class="limited-time">
                <p>⏰ このオファーは <span id="vipTimer">24:00:00</span> 後に終了します</p>
            </div>
            
            <button class="close-vip" onclick="closeVIPModal()">今回はやめておく</button>
        </div>
    </div>

    <!-- 個人鑑定モーダル -->
    <div id="personalReadingModal" class="personal-modal" style="display: none;">
        <div class="personal-modal-content">
            <div class="personal-header">
                <div class="personal-icon">🌟</div>
                <h1>完全個人鑑定</h1>
                <p>有名占い師があなただけのために60分間</p>
            </div>
            
            <div class="personal-features">
                <div class="feature">
                    <span class="feature-icon">🎯</span>
                    <h3>完全カスタマイズ</h3>
                    <p>あなたの悩みに100%フォーカス</p>
                </div>
                <div class="feature">
                    <span class="feature-icon">🔒</span>
                    <h3>完全プライベート</h3>
                    <p>1対1の秘密厳守セッション</p>
                </div>
                <div class="feature">
                    <span class="feature-icon">📝</span>
                    <h3>詳細レポート付き</h3>
                    <p>鑑定後、15ページの詳細レポート送付</p>
                </div>
            </div>
            
            <div class="personal-pricing">
                <div class="price-box">
                    <span class="original-personal-price">通常 ¥39,800</span>
                    <span class="special-personal-price">特別価格 ¥19,800</span>
                    <span class="savings">50%OFF（20,000円お得！）</span>
                </div>
            </div>
            
            <div class="urgency-message">
                <p>⚠️ 月間限定5名様のみ</p>
                <p>残り枠：<span class="slots-remaining">2名</span></p>
            </div>
            
            <button class="personal-cta" onclick="bookPersonalReading()">
                今すぐ個人鑑定を予約する
            </button>
            
            <button class="close-personal" onclick="closePersonalModal()">後で検討する</button>
        </div>
    </div>

    <script>
        // ユーザーデータ
        let userData = {
            name: '',
            birthDate: '',
            fortuneType: '',
            startTime: new Date(),
            step: 1,
            totalSpent: 0
        };

        // 占術データベース
        const FortuneDatabase = {
            astrology: {
                name: '西洋占星術',
                getZodiac(birthDate) {
                    const date = new Date(birthDate);
                    const month = date.getMonth() + 1;
                    const day = date.getDate();
                    
                    if ((month == 3 && day >= 21) || (month == 4 && day <= 19)) return '牡羊座';
                    if ((month == 4 && day >= 20) || (month == 5 && day <= 20)) return '牡牛座';
                    if ((month == 5 && day >= 21) || (month == 6 && day <= 20)) return '双子座';
                    if ((month == 6 && day >= 21) || (month == 7 && day <= 22)) return '蟹座';
                    if ((month == 7 && day >= 23) || (month == 8 && day <= 22)) return '獅子座';
                    if ((month == 8 && day >= 23) || (month == 9 && day <= 22)) return '乙女座';
                    if ((month == 9 && day >= 23) || (month == 10 && day <= 22)) return '天秤座';
                    if ((month == 10 && day >= 23) || (month == 11 && day <= 21)) return '蠍座';
                    if ((month == 11 && day >= 22) || (month == 12 && day <= 21)) return '射手座';
                    if ((month == 12 && day >= 22) || (month == 1 && day <= 19)) return '山羊座';
                    if ((month == 1 && day >= 20) || (month == 2 && day <= 18)) return '水瓶座';
                    return '魚座';
                },
                generateResult(name, birthDate) {
                    const zodiac = this.getZodiac(birthDate);
                    const zodiacTraits = {
                        '牡羊座': { element: '火', ruler: '火星', trait: '情熱的でリーダーシップ' },
                        '牡牛座': { element: '地', ruler: '金星', trait: '堅実で美的センス' },
                        '双子座': { element: '風', ruler: '水星', trait: '知的でコミュニケーション能力' },
                        '蟹座': { element: '水', ruler: '月', trait: '感受性豊かで家族思い' },
                        '獅子座': { element: '火', ruler: '太陽', trait: 'カリスマ性と創造力' },
                        '乙女座': { element: '地', ruler: '水星', trait: '分析力と完璧主義' },
                        '天秤座': { element: '風', ruler: '金星', trait: 'バランス感覚と社交性' },
                        '蠍座': { element: '水', ruler: '冥王星', trait: '洞察力と情熱' },
                        '射手座': { element: '火', ruler: '木星', trait: '冒険心と楽観性' },
                        '山羊座': { element: '地', ruler: '土星', trait: '野心と忍耐力' },
                        '水瓶座': { element: '風', ruler: '天王星', trait: '独創性と博愛精神' },
                        '魚座': { element: '水', ruler: '海王星', trait: '直感力と芸術性' }
                    };
                    
                    const trait = zodiacTraits[zodiac];
                    
                    return `
                        <div class="result-card">
                            <div class="result-header">
                                <span class="result-icon">🌟</span>
                                <span class="result-title">${name}様は${zodiac}です</span>
                            </div>
                            <div class="result-content">
                                <p>支配星：${trait.ruler} | エレメント：${trait.element}</p>
                                <p>基本性格：${trait.trait}に優れています。</p>
                                <div class="fortune-detail">
                                    <h4>💕 恋愛運</h4>
                                    <p>${zodiac}の${name}様は、今月特に魅力が高まっています。${trait.element}のエレメントが強まり、異性を惹きつける力が最高潮に。</p>
                                    <h4>💰 金運</h4>
                                    <p>${trait.ruler}の影響で、臨時収入の可能性が。特に15日前後は要チェック。</p>
                                    <h4>🍀 ラッキーアイテム</h4>
                                    <p>${trait.element}に関連するアイテムを身につけると運気上昇！</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
            },
            
            tarot: {
                name: 'タロット占い',
                cards: [
                    { name: '愚者', meaning: '新しい始まり、無限の可能性' },
                    { name: '魔術師', meaning: '創造力、実現力' },
                    { name: '女教皇', meaning: '直感、内なる声' },
                    { name: '女帝', meaning: '豊穣、母性' },
                    { name: '皇帝', meaning: '権威、安定' },
                    { name: '教皇', meaning: '伝統、精神性' },
                    { name: '恋人', meaning: '選択、調和' },
                    { name: '戦車', meaning: '勝利、前進' },
                    { name: '力', meaning: '内なる強さ、勇気' },
                    { name: '隠者', meaning: '内省、真実の探求' },
                    { name: '運命の輪', meaning: '転機、チャンス' },
                    { name: '正義', meaning: 'バランス、公正' },
                    { name: '吊るされた男', meaning: '試練、新たな視点' },
                    { name: '死神', meaning: '変化、再生' },
                    { name: '節制', meaning: '調和、忍耐' },
                    { name: '悪魔', meaning: '執着、誘惑' },
                    { name: '塔', meaning: '突然の変化、覚醒' },
                    { name: '星', meaning: '希望、インスピレーション' },
                    { name: '月', meaning: '不安、幻想' },
                    { name: '太陽', meaning: '成功、喜び' },
                    { name: '審判', meaning: '復活、新たな始まり' },
                    { name: '世界', meaning: '完成、達成' }
                ],
                generateResult(name) {
                    const past = this.cards[Math.floor(Math.random() * this.cards.length)];
                    const present = this.cards[Math.floor(Math.random() * this.cards.length)];
                    const future = this.cards[Math.floor(Math.random() * this.cards.length)];
                    
                    return `
                        <div class="result-card">
                            <div class="result-header">
                                <span class="result-icon">🎴</span>
                                <span class="result-title">${name}様のタロットリーディング</span>
                            </div>
                            <div class="result-content">
                                <div class="tarot-spread">
                                    <div class="tarot-position">
                                        <h4>過去</h4>
                                        <p class="card-name">${past.name}</p>
                                        <p class="card-meaning">${past.meaning}</p>
                                    </div>
                                    <div class="tarot-position">
                                        <h4>現在</h4>
                                        <p class="card-name">${present.name}</p>
                                        <p class="card-meaning">${present.meaning}</p>
                                    </div>
                                    <div class="tarot-position">
                                        <h4>未来</h4>
                                        <p class="card-name">${future.name}</p>
                                        <p class="card-meaning">${future.meaning}</p>
                                    </div>
                                </div>
                                <p style="margin-top: 20px;">
                                    ${name}様の運命は「${past.name}」から「${present.name}」を経て「${future.name}」へと向かっています。
                                    特に${future.name}のカードは、近い将来の重要な転機を示唆しています。
                                </p>
                            </div>
                        </div>
                    `;
                }
            },
            
            numerology: {
                name: '数秘術',
                calculateLifePath(birthDate) {
                    const date = birthDate.replace(/-/g, '');
                    let sum = date.split('').reduce((a, b) => a + parseInt(b), 0);
                    while (sum > 9 && sum !== 11 && sum !== 22 && sum !== 33) {
                        sum = sum.toString().split('').reduce((a, b) => a + parseInt(b), 0);
                    }
                    return sum;
                },
                generateResult(name, birthDate) {
                    const lifePathNumber = this.calculateLifePath(birthDate);
                    const meanings = {
                        1: { trait: 'リーダーシップと独立心', color: '赤', gem: 'ルビー' },
                        2: { trait: '協調性と感受性', color: 'オレンジ', gem: 'ムーンストーン' },
                        3: { trait: '創造性と表現力', color: '黄', gem: 'トパーズ' },
                        4: { trait: '安定と実践力', color: '緑', gem: 'エメラルド' },
                        5: { trait: '自由と冒険心', color: '青', gem: 'サファイア' },
                        6: { trait: '愛と責任感', color: 'インディゴ', gem: 'ラピスラズリ' },
                        7: { trait: '探求心と内省', color: '紫', gem: 'アメジスト' },
                        8: { trait: '成功と物質的達成', color: 'ピンク', gem: 'ローズクォーツ' },
                        9: { trait: '博愛と奉仕精神', color: '金', gem: 'シトリン' },
                        11: { trait: 'スピリチュアルな洞察力', color: '銀', gem: 'クリスタル' },
                        22: { trait: 'マスタービルダー', color: '銅', gem: 'タイガーアイ' },
                        33: { trait: 'マスターティーチャー', color: '白', gem: 'ダイヤモンド' }
                    };
                    
                    const meaning = meanings[lifePathNumber] || meanings[1];
                    
                    return `
                        <div class="result-card">
                            <div class="result-header">
                                <span class="result-icon">🔢</span>
                                <span class="result-title">${name}様のライフパスナンバー：${lifePathNumber}</span>
                            </div>
                            <div class="result-content">
                                <div class="numerology-result">
                                    <p>基本性質：${meaning.trait}</p>
                                    <p>ラッキーカラー：${meaning.color}</p>
                                    <p>パワーストーン：${meaning.gem}</p>
                                    <div class="fortune-detail">
                                        <h4>📊 ${name}様の数秘術詳細</h4>
                                        <p>ライフパスナンバー${lifePathNumber}を持つ${name}様は、${meaning.trait}に優れた人物です。</p>
                                        <p>今月は特に数字の${lifePathNumber}に関連する日（${lifePathNumber}日、${lifePathNumber + 9}日、${lifePathNumber + 18}日）が幸運日となります。</p>
                                        <p>相性の良い数字：${(lifePathNumber + 3) % 9 || 9}、${(lifePathNumber + 6) % 9 || 9}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            },
            
            animal: {
                name: '動物占い',
                getAnimal(birthDate) {
                    const date = new Date(birthDate);
                    const year = date.getFullYear();
                    const animals = [
                        'こじか', 'たぬき', 'さる', 'チータ', 'くろひょう',
                        'ライオン', 'トラ', 'ひつじ', 'ペガサス', 'ゾウ', 'オオカミ', 'コアラ'
                    ];
                    const index = (year + date.getMonth() + date.getDate()) % 12;
                    return animals[index];
                },
                generateResult(name, birthDate) {
                    const animal = this.getAnimal(birthDate);
                    const traits = {
                        'こじか': { type: '愛されキャラ', love: '素直で可愛らしい', work: 'サポート役' },
                        'たぬき': { type: '人気者', love: '愛嬌がある', work: 'ムードメーカー' },
                        'さる': { type: 'お調子者', love: '楽しい恋愛', work: 'アイデアマン' },
                        'チータ': { type: 'スピード重視', love: '情熱的', work: '即断即決' },
                        'くろひょう': { type: 'クール', love: 'ミステリアス', work: '戦略家' },
                        'ライオン': { type: 'リーダー', love: '守ってくれる', work: '統率力' },
                        'トラ': { type: '一匹狼', love: '一途', work: '職人気質' },
                        'ひつじ': { type: '平和主義', love: '優しい', work: '協調性' },
                        'ペガサス': { type: '自由人', love: '束縛嫌い', work: 'クリエイティブ' },
                        'ゾウ': { type: '努力家', love: '誠実', work: '堅実' },
                        'オオカミ': { type: '個性的', love: '深い愛情', work: '独創的' },
                        'コアラ': { type: 'マイペース', love: 'のんびり', work: '独自路線' }
                    };
                    
                    const trait = traits[animal] || traits['こじか'];
                    
                    return `
                        <div class="result-card">
                            <div class="result-header">
                                <span class="result-icon">🐾</span>
                                <span class="result-title">${name}様は「${animal}」タイプです</span>
                            </div>
                            <div class="result-content">
                                <div class="animal-result">
                                    <p>基本性格：${trait.type}</p>
                                    <div class="fortune-detail">
                                        <h4>💕 恋愛傾向</h4>
                                        <p>${trait.love}な恋愛をする傾向があります。</p>
                                        <h4>💼 仕事運</h4>
                                        <p>${trait.work}として活躍できるでしょう。</p>
                                        <h4>🤝 相性の良い動物</h4>
                                        <p>特に相性が良いのは${this.getCompatibleAnimal(animal)}タイプの人です。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                },
                getCompatibleAnimal(animal) {
                    const compatibility = {
                        'こじか': 'ライオン',
                        'たぬき': 'ひつじ',
                        'さる': 'チータ',
                        'チータ': 'さる',
                        'くろひょう': 'ゾウ',
                        'ライオン': 'こじか',
                        'トラ': 'ペガサス',
                        'ひつじ': 'たぬき',
                        'ペガサス': 'トラ',
                        'ゾウ': 'くろひょう',
                        'オオカミ': 'コアラ',
                        'コアラ': 'オオカミ'
                    };
                    return compatibility[animal] || 'ライオン';
                }
            },
            
            shichu: {
                name: '四柱推命',
                getTenkan(year) {
                    const tenkan = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
                    return tenkan[(year - 4) % 10];
                },
                getChishi(year) {
                    const chishi = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];
                    return chishi[(year - 4) % 12];
                },
                generateResult(name, birthDate) {
                    const date = new Date(birthDate);
                    const year = date.getFullYear();
                    const tenkan = this.getTenkan(year);
                    const chishi = this.getChishi(year);
                    
                    const elements = {
                        '甲': '木', '乙': '木', '丙': '火', '丁': '火',
                        '戊': '土', '己': '土', '庚': '金', '辛': '金',
                        '壬': '水', '癸': '水'
                    };
                    
                    const element = elements[tenkan];
                    
                    return `
                        <div class="result-card">
                            <div class="result-header">
                                <span class="result-icon">🐉</span>
                                <span class="result-title">${name}様の四柱推命</span>
                            </div>
                            <div class="result-content">
                                <div class="shichu-result">
                                    <p>年柱：${tenkan}${chishi}（${element}の性質）</p>
                                    <div class="fortune-detail">
                                        <h4>🌟 ${name}様の宿命</h4>
                                        <p>${element}の性質を持つ${name}様は、${this.getElementTrait(element)}という特性があります。</p>
                                        <h4>📅 今年の運勢</h4>
                                        <p>${tenkan}${chishi}年生まれの${name}様にとって、今年は${this.getYearlyFortune(element)}の年となります。</p>
                                        <h4>💎 開運方法</h4>
                                        <p>${element}の気を高めるには、${this.getLuckyMethod(element)}が効果的です。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                },
                getElementTrait(element) {
                    const traits = {
                        '木': '成長力と柔軟性',
                        '火': '情熱と行動力',
                        '土': '安定と信頼',
                        '金': '決断力と正義感',
                        '水': '知恵と適応力'
                    };
                    return traits[element] || '特別な才能';
                },
                getYearlyFortune(element) {
                    const fortunes = {
                        '木': '新しいことを始めるのに最適',
                        '火': '積極的な行動が吉',
                        '土': '堅実な努力が実を結ぶ',
                        '金': '決断と実行の',
                        '水': '流れに身を任せると良い'
                    };
                    return fortunes[element] || '大きな転機';
                },
                getLuckyMethod(element) {
                    const methods = {
                        '木': '観葉植物を育てる、緑の多い場所へ行く',
                        '火': '太陽の光を浴びる、赤い物を身につける',
                        '土': '陶芸や園芸、黄色い物を取り入れる',
                        '金': '金属製のアクセサリー、白い物を選ぶ',
                        '水': '水辺で過ごす、青や黒を基調にする'
                    };
                    return methods[element] || '瞑想と深呼吸';
                }
            }
        };

        // =====================================
        // 💰 収益最大化システム
        // =====================================

        // ポイントシステム初期化
        function initPointSystem() {
            // ポイント表示バー追加
            const pointsBar = document.createElement('div');
            pointsBar.className = 'points-bar';
            pointsBar.innerHTML = `
                <span class="points-icon">💎</span>
                <span class="points-amount">${getPoints()}</span>
                <span>pt</span>
                <button class="add-points-btn" onclick="showPointModal()">+</button>
            `;
            pointsBar.onclick = showPointModal;
            document.body.appendChild(pointsBar);
            
            // ユーザーのステータスチェック
            checkUserStatus();
        }

        // ポイント取得
        function getPoints() {
            return parseInt(localStorage.getItem('userPoints') || '0');
        }

        // ポイント追加
        function addUserPoints(amount) {
            const current = getPoints();
            const newAmount = current + amount;
            localStorage.setItem('userPoints', newAmount.toString());
            updatePointsDisplay();
        }

        // ポイント表示更新
        function updatePointsDisplay() {
            const displays = document.querySelectorAll('.points-amount, #userPoints');
            displays.forEach(el => {
                if (el) el.textContent = getPoints().toLocaleString();
            });
        }

        // ポイントモーダル表示
        function showPointModal() {
            document.getElementById('pointSystemModal').style.display = 'flex';
            updatePointsDisplay();
        }

        // ポイントモーダル閉じる
        function closePointModal() {
            document.getElementById('pointSystemModal').style.display = 'none';
        }

        // ポイント購入処理
        function purchasePoints(points, price) {
            // アナリティクス送信
            gtag('event', 'purchase_points', {
                'value': price,
                'currency': 'JPY',
                'points': points
            });
            
            // 購入確認
            if (confirm(`${points.toLocaleString()}ポイントを¥${price.toLocaleString()}で購入しますか？`)) {
                // Stripe決済へ（実際の実装時は価格別のリンクを用意）
                localStorage.setItem('pendingPoints', points.toString());
                window.location.href = `https://buy.stripe.com/test_${getPriceId(price)}`;
            }
        }

        // 価格IDマッピング（Stripeで作成後に更新）
        function getPriceId(price) {
            const priceMap = {
                1000: 'price_1000',
                4500: 'price_4500',
                8000: 'price_8000',
                21000: 'price_21000'
            };
            return priceMap[price] || 'price_default';
        }

        // VIPプラン表示
        function showVIPModal() {
            document.getElementById('vipPlanModal').style.display = 'flex';
            startVIPTimer();
        }

        // VIPモーダル閉じる
        function closeVIPModal() {
            document.getElementById('vipPlanModal').style.display = 'none';
            
            // ダウンセル表示
            setTimeout(() => {
                showDownsellOffer();
            }, 2000);
        }

        // VIPタイマー
        function startVIPTimer() {
            let hours = 24;
            let minutes = 0;
            let seconds = 0;
            
            const timerInterval = setInterval(() => {
                seconds--;
                if (seconds < 0) {
                    seconds = 59;
                    minutes--;
                    if (minutes < 0) {
                        minutes = 59;
                        hours--;
                        if (hours < 0) {
                            clearInterval(timerInterval);
                            closeVIPModal();
                            return;
                        }
                    }
                }
                
                const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                const timerEl = document.getElementById('vipTimer');
                if (timerEl) timerEl.textContent = display;
            }, 1000);
        }

        // VIP購読
        function subscribeVIP() {
            gtag('event', 'subscribe_vip', {
                'value': 4980,
                'currency': 'JPY'
            });
            
            localStorage.setItem('vipMember', 'true');
            window.location.href = 'https://buy.stripe.com/test_vip_monthly';
        }

        // ダウンセルオファー
        function showDownsellOffer() {
            const downsell = document.createElement('div');
            downsell.className = 'downsell-popup';
            downsell.innerHTML = `
                <div class="downsell-content">
                    <h2>😱 ちょっと待って！</h2>
                    <p>特別オファー：初月だけ50%OFF</p>
                    <div class="downsell-price">
                        <span class="original">月額¥4,980</span>
                        <span class="special">初月¥2,490</span>
                    </div>
                    <button onclick="acceptDownsell()">このチャンスを逃さない</button>
                    <button onclick="this.parentElement.parentElement.remove()">いいえ、結構です</button>
                </div>
            `;
            downsell.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: white;
                border-radius: 20px;
                padding: 30px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                z-index: 30000;
                animation: slideIn 0.5s;
            `;
            document.body.appendChild(downsell);
        }

        // ダウンセル受諾
        function acceptDownsell() {
            gtag('event', 'accept_downsell', {
                'value': 2490,
                'currency': 'JPY'
            });
            
            window.location.href = 'https://buy.stripe.com/test_downsell';
        }

        // 個人鑑定モーダル表示
        function showPersonalReadingModal() {
            document.getElementById('personalReadingModal').style.display = 'flex';
            
            // 残り枠をランダムに変更（緊急性演出）
            const slots = Math.floor(Math.random() * 3) + 1;
            document.querySelector('.slots-remaining').textContent = `${slots}名`;
        }

        // 個人鑑定モーダル閉じる
        function closePersonalModal() {
            document.getElementById('personalReadingModal').style.display = 'none';
        }

        // 個人鑑定予約
        function bookPersonalReading() {
            gtag('event', 'book_personal_reading', {
                'value': 19800,
                'currency': 'JPY'
            });
            
            window.location.href = 'https://buy.stripe.com/test_personal_reading';
        }

        // ユーザーステータスチェック
        function checkUserStatus() {
            const totalSpent = parseInt(localStorage.getItem('totalSpent') || '0');
            const lastOffer = localStorage.getItem('lastOffer');
            const today = new Date().toDateString();
            
            // 累計支出に応じてオファー表示
            if (totalSpent >= 9800 && !localStorage.getItem('vipMember')) {
                // 9,800円以上使った人にVIPオファー
                setTimeout(() => showVIPModal(), 5000);
            } else if (totalSpent >= 4980 && lastOffer !== today) {
                // 4,980円以上使った人に個人鑑定オファー
                setTimeout(() => showPersonalReadingModal(), 10000);
                localStorage.setItem('lastOffer', today);
            } else if (totalSpent >= 1980) {
                // 1,980円以上使った人にポイント購入促進
                setTimeout(() => showPointModal(), 15000);
            }
        }

        // アップセル自動化
        function triggerUpsell() {
            const step = userData.step;
            const totalSpent = userData.totalSpent || 0;
            
            if (step === 3 && totalSpent === 0) {
                // 初回課金前
                setTimeout(() => {
                    showNotification('💎 特別オファー', 'ポイント購入で全機能解放！');
                }, 30000);
            } else if (totalSpent >= 480 && totalSpent < 1980) {
                // 2次課金促進
                setTimeout(() => {
                    showNotification('🎯 限定', '今だけ50%OFFで詳細鑑定');
                }, 20000);
            }
        }

        // 課金フロー最適化
        const optimizedPricing = {
            step1: 480,    // 初回（維持）
            step2: 1980,   // 2次（980→1980に変更）
            step3: 4980,   // 3次
            step4: 9800,   // 4次
            monthly: 4980  // 月額
        };

        // 決済処理の更新
        function processOptimizedPayment(step) {
            const price = optimizedPricing[`step${step}`];
            
            // 累計支出更新
            userData.totalSpent = (userData.totalSpent || 0) + price;
            localStorage.setItem('totalSpent', userData.totalSpent.toString());
            
            // アナリティクス
            gtag('event', 'purchase', {
                'value': price,
                'currency': 'JPY',
                'transaction_id': Date.now(),
                'items': [{
                    'item_name': `Step ${step} Fortune`,
                    'price': price,
                    'quantity': 1
                }]
            });
            
            // 次のオファーをスケジュール
            scheduleNextOffer(userData.totalSpent);
            
            // Stripe決済へ
            window.location.href = `https://buy.stripe.com/test_step${step}`;
        }

        // 次のオファースケジューリング
        function scheduleNextOffer(totalSpent) {
            if (totalSpent >= 9800) {
                // VIP会員への誘導
                localStorage.setItem('nextOffer', 'vip');
            } else if (totalSpent >= 4980) {
                // 個人鑑定への誘導
                localStorage.setItem('nextOffer', 'personal');
            } else if (totalSpent >= 1980) {
                // ポイント大量購入への誘導
                localStorage.setItem('nextOffer', 'points');
            }
        }

        // =====================================
        // 🔥 PWAインストール促進システム
        // =====================================
        let deferredPrompt;
        let installCount = 0;

        // PWAインストール可能時
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // 戦略的タイミングで表示
            if (userData.step === 3 && userData.converted) {
                // 課金直後が最高のタイミング！
                setTimeout(() => showInstallBanner('payment'), 3000);
            } else if (localStorage.getItem('visitCount') >= 3) {
                // 3回目の訪問
                showInstallBanner('return');
            }
        });

        // インストールバナー表示
        function showInstallBanner(trigger) {
            const messages = {
                payment: {
                    title: '🎊 特別ボーナス解放！',
                    text: 'アプリ追加で毎日無料占い＋1,000円分のポイント！',
                    button: '今すぐ1,000円GET'
                },
                return: {
                    title: '⚡ 重要なお知らせ',
                    text: 'ホーム画面追加で運命の転機を見逃さない！',
                    button: '無料で追加'
                }
            };
            
            const msg = messages[trigger] || messages.return;
            
            const banner = document.createElement('div');
            banner.style.cssText = `
                position: fixed;
                bottom: 80px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #FFD700, #FF6B6B);
                padding: 20px;
                border-radius: 20px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                z-index: 10000;
                animation: slideUp 0.5s ease-out;
                max-width: 90%;
                width: 400px;
            `;
            
            banner.innerHTML = `
                <div style="color: white; text-align: center;">
                    <h3 style="margin: 0 0 10px; font-size: 20px;">${msg.title}</h3>
                    <p style="margin: 0 0 15px; opacity: 0.95;">${msg.text}</p>
                    <button onclick="installPWA()" style="
                        background: white;
                        color: #FF6
